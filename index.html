<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Coloring Book App</title>
<style>
  html,body { margin:0; padding:0; height:100%; overflow:hidden; touch-action:none; background:#eee; }
  #toolbar { position:fixed; top:0; width:100%; background:#fff; display:flex; justify-content:space-around; align-items:center; padding:8px; z-index:2; box-shadow:0 2px 5px rgba(0,0,0,0.2); }
  #toolbar button { background:none; border:none; font-size:24px; cursor:pointer; }
  #bottom-tools { position:fixed; bottom:0; width:100%; background:#fff; display:flex; justify-content:center; align-items:center; padding:8px; z-index:2; box-shadow:0 -2px 5px rgba(0,0,0,0.2); }
  #bottom-tools .tool, .color { margin:0 6px; padding:8px; border:1px solid #333; border-radius:6px; font-size:20px; cursor:pointer; }
  .color { width:28px; height:28px; }
  .active { border-color:red !important; }
  canvas { position:fixed; top:0; left:0; width:100%; height:100%; object-fit:contain; background:#fff; z-index:1; }
</style>
</head>
<body>
<div id="toolbar">
  <button id="undoBtn">‚Ü∂</button>
  <button id="redoBtn">‚Ü∑</button>
  <button id="downloadBtn">‚¨á Donwload</button>
  <button id="clearBtn">üóëÔ∏è Clear</button>
  <button id="saveBtn">üíæ Save</button>
</div>
<canvas id="drawCanvas"></canvas>
<div id="bottom-tools"></div>

<script>
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
let currImg = null, tool='bucket', color='black';
let scale=1, offsetX=0, offsetY=0;
let isPanning=false, startX, startY;
const undoStack=[], redoStack=[], savedImages=[];
const clickSound = new Audio('click.mp3'), fillSound = new Audio('fill.mp3');

function resizeCanvas(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  redrawCanvas();
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function redrawCanvas(){
  ctx.setTransform(scale,0,0,scale,offsetX,offsetY);
  ctx.clearRect(0,0,canvas.width/scale,canvas.height/scale);
  if(currImg) ctx.drawImage(currImg, 0,0,canvas.width/scale,canvas.height/scale);
}
function pushState(){
  undoStack.push(canvas.toDataURL());
  if(undoStack.length>50) undoStack.shift();
  redoStack.length=0;
}
function undo(){
  if(undoStack.length<2) return;
  redoStack.push(undoStack.pop());
  restore(undoStack[undoStack.length-1]);
}
function redo(){
  if(!redoStack.length) return;
  const d=redoStack.pop();
  undoStack.push(d);
  restore(d);
}
function restore(src){
  const img2=new Image();
  img2.onload=()=>{ currImg=img2; redrawCanvas(); };
  img2.src=src;
}

function clear(){
  currImg = new Image();
  redrawCanvas();
  pushState();
}
function saveLibrary(){
  savedImages.push(canvas.toDataURL());
  alert('Saved to library!');
}
function download(){
  clickSound.play();
  const a=document.createElement('a');
  a.download='my_color.png';
  a.href=canvas.toDataURL();
  a.click();
}

function loadImage(src){
  const img2=new Image();
  img2.crossOrigin='anonymous';
  img2.onload=()=>{
    currImg=img2;
    scale=1; offsetX=0; offsetY=0;
    redrawCanvas();
    pushState();
  };
  img2.src = src+'?'+Date.now();
}
const drawings=[
  'https://i.postimg.cc/TPZTn08W/0f00c43f3775ba5fcce443f4885aa56e.jpg',
  'https://i.postimg.cc/JnZMxXmY/bunny-carrot-coloring-page-600nw-2414476443.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/pLsT5KXD/6331b296558cf1f8f7fd87cc9154f432.jpg',
  'https://i.postimg.cc/2yYmK5Sk/7113dc553901fe5719b2c9e221449e28.jpg',
  'https://i.postimg.cc/MKxKs9n7/adorable-fun-kids-coloring-page-delight-freepik-908673-3027.jpg',
  'https://i.postimg.cc/MKxKs9n7/adorable-fun-kids-coloring-page-delight-freepik-908673-3027.jpg',
  'https://i.postimg.cc/jS1TrcSk/Barbie-10.jpg',
  'https://i.postimg.cc/FsDmTN5v/Barbie-24.jpg',
  'https://i.postimg.cc/FsDmTN5v/Barbie-24.jpg',
  'https://i.postimg.cc/j2YdYXZr/Barbie-27.jpg',
  'https://i.postimg.cc/tTxCcfd5/Barbie-6.jpg'
];
// (Add your drawing-selection UI elsewhere, call loadImage(idx))

canvas.addEventListener('mousedown', e=>{
  if(e.button===1){ // middle click pan
    isPanning=true;
    startX=e.clientX-offsetX;
    startY=e.clientY-offsetY;
  }
});
canvas.addEventListener('mousemove', e=>{
  if(isPanning){
    offsetX=e.clientX-startX;
    offsetY=e.clientY-startY;
    redrawCanvas();
  }
});
canvas.addEventListener('mouseup', e=>{
  isPanning=false;
});

canvas.addEventListener('wheel', e=>{
  e.preventDefault();
  const delta=e.deltaY>0?0.9:1.1;
  scale*=delta;
  redrawCanvas();
});

canvas.addEventListener('touchstart', e=>{
  if(e.touches.length===2){
    lastDist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
  } else if(e.touches.length===1){
    isPanning=true;
    startX=e.touches[0].clientX-offsetX;
    startY=e.touches[0].clientY-offsetY;
  }
});
canvas.addEventListener('touchmove', e=>{
  e.preventDefault();
  if(e.touches.length===2){
    const d = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY);
    scale *= d/lastDist;
    lastDist = d;
    redrawCanvas();
  } else if(isPanning){
    offsetX=e.touches[0].clientX - startX;
    offsetY=e.touches[0].clientY - startY;
    redrawCanvas();
  }
});
canvas.addEventListener('touchend', e=>{
  if(e.touches.length<2) lastDist=null;
  if(e.touches.length===0) isPanning=false;
});

function getXY(e){
  const rect=canvas.getBoundingClientRect();
  const x=(e.clientX-rect.left-offsetX)/scale;
  const y=(e.clientY-rect.top-offsetY)/scale;
  return {x,y};
}
// implement bucket fill & eraser similar to your code, mapping to transformed coords

// toolbar buttons
document.getElementById('undoBtn').onclick = ()=>{undo(); clickSound.play()};
document.getElementById('redoBtn').onclick = ()=>{redo(); clickSound.play()};
document.getElementById('downloadBtn').onclick = download;
document.getElementById('clearBtn').onclick = ()=>{clear(); clickSound.play()};
document.getElementById('saveBtn').onclick = ()=>{saveLibrary(); clickSound.play()};

// bottom palette
const bottom = document.getElementById('bottom-tools');
['bucket','eraser'].forEach(toolName=>{
  const btn=document.createElement('div');
  btn.className='tool';
  btn.textContent = toolName==='bucket'?'ü™£':'üßΩ';
  btn.onclick=()=>{
    tool=toolName; clickSound.play();
    [...document.querySelectorAll('.tool')].forEach(el=>el.classList.toggle('active',el===btn));
  };
  bottom.appendChild(btn);
});
['black','red','green','blue','yellow'].forEach(c=>{
  const d=document.createElement('div');
  d.className='color'; d.style.background=c;
  d.onclick=()=>{
    color=c; clickSound.play();
    [...document.querySelectorAll('.color')].forEach(el=>el.classList.toggle('active',el===d));
  };
  bottom.appendChild(d);
});

// initial state
loadImage(drawings[0]);
</script>
</body>
</html>
