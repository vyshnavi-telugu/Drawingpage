<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>Mobile Coloring Book with Zoom Limits</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  html,body{height:100%;overflow:hidden;font-family:sans-serif;}
  #home,#library,#pageSelect,#drawing{display:none;flex-direction:column;align-items:center;justify-content:center;height:100%;}
  #home{display:flex;}
  button{margin:12px;padding:12px 20px;font-size:18px;}
  #top-bar,#bottom-bar{display:flex;align-items:center;background:#eee;padding:6px;width:100%;overflow-x:auto;}
  canvas{touch-action:none;border:1px solid #ccc;background:#fff;max-width:100%;max-height:calc(100% - 104px);}
  .tool,.color{margin:4px;padding:6px;border:1px solid #333;border-radius:4px;font-size:20px;cursor:pointer;}
  .color{width:28px;height:28px;}
  .active{border:2px solid red!important;}
  #undoBtn{color:skyblue;}#redoBtn{color:orange;}#saveBtn{color:green;}
  #deleteBtn{color:red;}#downloadBtn{color:goldenrod;}
</style>
</head>
<body>
  <div id="home">
    <button onclick="showPageSelect()">ðŸŽ¨ Start Coloring</button>
    <button onclick="showLibrary()">ðŸ“š Saved Images</button>
  </div>
  <div id="library"></div>
  <div id="pageSelect"></div>
  <div id="drawing">
    <div id="top-bar">
      <button id="undoBtn">Undo</button>
      <button id="redoBtn">Redo</button>
      <button id="saveBtn">Save</button>
      <button id="deleteBtn">Delete</button>
      <button id="downloadBtn">Download</button>
    </div>
    <canvas id="drawCanvas" width="600" height="600"></canvas>
    <div id="bottom-bar">
      <div class="tool" data-tool="bucket">ðŸª£</div>
      <div class="tool" data-tool="eraser">ðŸ§½</div>
    </div>
  </div>

<script>
// Configuration
const MIN_SCALE = 0.5;
const MAX_SCALE = 3;

// State
const drawings = [
  'https://i.postimg.cc/TPZTn08W/0f00c43f3775ba5fcce443f4885aa56e.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/pLsT5KXD/6331b296558cf1f8f7fd87cc9154f432.jpg',
    'https://i.postimg.cc/2yYmK5Sk/7113dc553901fe5719b2c9e221449e28.jpg',
    'https://i.postimg.cc/MKxKs9n7/adorable-fun-kids-coloring-page-delight-freepik-908673-3027.jpg',
    'https://i.postimg.cc/jS1TrcSk/Barbie-10.jpg',
    'https://i.postimg.cc/FsDmTN5v/Barbie-24.jpg',
    'https://i.postimg.cc/j2YdYXZr/Barbie-27.jpg',
  'https://i.postimg.cc/cJ6JR6rP/bc2884b1a90b6d9db42580113054c40b.jpg'
];
const savedImages = [];
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
let img = new Image(), tool='bucket', color='black';
let scale=1, offset={x:0,y:0}, lastDist=null, lastMid=null;
let isPanning=false, panStart={x:0,y:0};
const undoStack=[], redoStack=[];

// Show/hide screens
function show(id){
  ['home','library','pageSelect','drawing'].forEach(x=>
    document.getElementById(x).style.display = x===id ? 'flex':'none');
}
function showLibrary(){
  show('library');
  let lib = document.getElementById('library');
  lib.innerHTML = '<h2>Saved Images</h2>';
  savedImages.forEach(src=>{
    let i = document.createElement('img');
    i.src = src; i.style.maxWidth='90%'; i.style.margin='10px';
    lib.appendChild(i);
  });
  let b = document.createElement('button');
  b.textContent='â¬… Back'; b.onclick=()=>show('home');
  lib.appendChild(b);
}
function showPageSelect(){
  show('pageSelect');
  let ps = document.getElementById('pageSelect');
  ps.innerHTML = '<h2>Select a Page</h2>';
  drawings.forEach((src,i)=>{
    let t = document.createElement('img');
    t.src = src; t.style.width='120px'; t.style.margin='10px';
    t.onclick = ()=>loadPage(i);
    ps.appendChild(t);
  });
  let b = document.createElement('button');
  b.textContent='â¬… Back'; b.onclick=()=>show('home');
  ps.appendChild(b);
}

// Undo/redo/save/clear/download
function pushUndo(){
  undoStack.push(canvas.toDataURL());
  if(undoStack.length>50) undoStack.shift();
  redoStack.length=0;
}
function restore(src){
  let im = new Image();
  im.onload = ()=>ctx.drawImage(im,0,0);
  im.src = src;
}
function undo(){
  if(undoStack.length<2) return;
  redoStack.push(undoStack.pop());
  restore(undoStack[undoStack.length-1]);
}
function redo(){
  if(!redoStack.length) return;
  let d = redoStack.pop();
  undoStack.push(d);
  restore(d);
}
function save(){
  savedImages.push(canvas.toDataURL());
  alert('Saved to library!');
}
function download(){
  let a = document.createElement('a');
  a.href = canvas.toDataURL(); a.download='coloring.png'; a.click();
}
function clearCanvas(){
  scale = 1; offset={x:0,y:0};
  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(img,0,0,canvas.width,canvas.height);
  pushUndo(); redraw();
}

// Load & redraw
function loadPage(i){
  show('drawing');
  img = new Image();
  img.crossOrigin='anonymous';
  img.onload = ()=>{
    scale =1; offset={x:0,y:0};
    redraw(); pushUndo();
  };
  img.src = drawings[i]+'?v='+Date.now();
}
function redraw(){
  ctx.setTransform(scale,0,0,scale,offset.x,offset.y);
  ctx.clearRect(-offset.x/scale, -offset.y/scale,
                canvas.width/scale,canvas.height/scale);
  ctx.drawImage(img,0,0,canvas.width,canvas.height);
}

// Flood-fill & eraser (same as before)
function hexToRGBA(hex){
  let tmp = document.createElement('div');
  tmp.style.color=hex; document.body.appendChild(tmp);
  let [r,g,b]=getComputedStyle(tmp).color.match(/\d+/g).map(Number);
  document.body.removeChild(tmp);
  return {r,g,b,a:255};
}
function floodfill(data,sx,sy,fill,tol,w,h){
  let base=data.slice((sy*w+sx)*4,(sy*w+sx)*4+4);
  let diff=(a,b)=>Math.abs(a[0]-b[0])+Math.abs(a[1]-b[1])+Math.abs(a[2]-b[2])+Math.abs(a[3]-b[3]);
  let isM=px=>diff(px,base)<tol;
  let stack=[{x:sx,y:sy}]; let visited=new Uint8Array(w*h);
  while(stack.length){
    let {x,y}=stack.pop();
    if(x<0||x>=w||y<0||y>=h) continue;
    let idx=y*w+x; if(visited[idx]) continue;
    visited[idx]=1;
    let i=idx*4,curr=data.slice(i,i+4);
    if(!isM(curr)) continue;
    data[i]=fill.r;data[i+1]=fill.g;data[i+2]=fill.b;data[i+3]=fill.a;
    stack.push({x:x+1,y},{x:x-1,y},{x,y:y+1},{x,y:y-1});
  }
}

// Input handling
function getXY(e){
  let r = canvas.getBoundingClientRect();
  return {
    x: Math.floor((e.clientX - r.left - offset.x)/scale),
    y: Math.floor((e.clientY - r.top - offset.y)/scale)
  };
}
canvas.addEventListener('click', e=>{
  const {x,y}=getXY(e);
  if(tool==='bucket'){
    let imgd=ctx.getImageData(0,0,canvas.width,canvas.height);
    floodfill(imgd.data,x,y,hexToRGBA(color),60,imgd.width,imgd.height);
    ctx.putImageData(imgd,0,0);
    pushUndo();
  } else {
    ctx.globalCompositeOperation='destination-out';
    ctx.beginPath(); ctx.arc(x,y,10,0,2*Math.PI);
    ctx.fill();
    ctx.globalCompositeOperation='source-over';
    pushUndo();
  }
});

// Touch zoom + pan with limits î¨1î¨‚
function dist(a,b){return Math.hypot(a.clientX-b.clientX,a.clientY-b.clientY);}
function mid(a,b){return{ x:(a.clientX+b.clientX)/2, y:(a.clientY+b.clientY)/2 };}
canvas.addEventListener('touchstart', e=>{
  if(e.touches.length===2){
    e.preventDefault();
    lastDist=dist(e.touches[0],e.touches[1]);
    lastMid=mid(e.touches[0],e.touches[1]);
  } else if(e.touches.length===1){
    isPanning=true;
    panStart={x:e.touches[0].clientX-offset.x, y:e.touches[0].clientY-offset.y};
  }
});
canvas.addEventListener('touchmove', e=>{
  if(e.touches.length===2){
    e.preventDefault();
    let d = dist(e.touches[0],e.touches[1]);
    let m = mid(e.touches[0],e.touches[1]);
    let factor = d/lastDist;
    let newScale = scale * factor;
    if(newScale < MIN_SCALE || newScale > MAX_SCALE) return;
    offset.x = m.x - factor*(lastMid.x - offset.x);
    offset.y = m.y - factor*(lastMid.y - offset.y);
    scale = newScale;
    lastDist = d; lastMid = m;
    redraw();
  } else if(e.touches.length===1 && isPanning){
    offset.x = e.touches[0].clientX - panStart.x;
    offset.y = e.touches[0].clientY - panStart.y;
    redraw();
  }
});
canvas.addEventListener('touchend', e=>{
  if(e.touches.length<2) lastDist=null;
  if(e.touches.length===0) isPanning=false;
});

// Initialize UI
document.getElementById('undoBtn').onclick=undo;
document.getElementById('redoBtn').onclick=redo;
document.getElementById('saveBtn').onclick=save;
document.getElementById('deleteBtn').onclick=clearCanvas;
document.getElementById('downloadBtn').onclick=download;
document.querySelectorAll('.tool').forEach(el=>
  el.onclick=()=>{
    tool = el.dataset.tool;
    document.querySelectorAll('.tool').forEach(t=>t.classList.toggle('active',t===el));
});
const colorArray=['black','gray','red','orange','yellow','green','blue','purple','pink','brown','white','cyan','magenta','lime','gold','navy','#ffe0bd','#ffcd94','#eac086','#ffad60','#ffe4c4'];
colorArray.forEach(c=>{
  let div=document.createElement('div');
  div.className='color'; div.style.background=c;
  div.onclick=()=>{
    color=c;
    document.querySelectorAll('.color').forEach(cc=>cc.classList.toggle('active',cc===div));
  };
  document.getElementById('bottom-bar').appendChild(div);
});
show('home');
</script>
</body>
</html>
