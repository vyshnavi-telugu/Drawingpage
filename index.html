<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Coloring Book App</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      height: 100%;
      width: 100%;
      overflow: hidden;
      touch-action: none;
    }
    body {
      display: flex;
      flex-direction: column;
    }
    #home, #library, #pageSelect, #drawing {
      display: none;
      flex: 1;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #home {
      background: linear-gradient(to bottom right, brown, red);
    }
    .home-btn {
      margin: 20px;
      border: none;
      background: none;
      cursor: pointer;
    }
    .home-btn img {
      width: 200px;
      height: auto;
    }
    #pageSelect img, #library img {
      width: 150px;
      margin: 10px;
      border: 2px solid #333;
      cursor: pointer;
    }
    #top-bar {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      background: #f0f0f0;
      padding: 10px;
    }
    .top-btn {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      background: #ffc107;
      border-radius: 8px;
      cursor: pointer;
    }
    .top-btn:hover {
      background: #ff9800;
    }
    #canvas-container {
      flex: 1;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
    }
    canvas {
      border: 1px solid #ccc;
      touch-action: none;
      transform-origin: 0 0;
    }
    #bottom-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background: #eee;
      padding: 10px;
    }
    .tool, .color {
      margin: 4px;
      padding: 6px;
      border: 2px solid #333;
      border-radius: 6px;
      font-size: 20px;
      cursor: pointer;
    }
    .color {
      width: 30px;
      height: 30px;
    }
    .active {
      border: 3px solid red !important;
    }
  </style>
</head>
<body>

<div id="home">
  <button class="home-btn" onclick="showLibrary()">
    <img src="https://img.icons8.com/clouds/200/000000/opened-folder.png" alt="Library" />
  </button>
  <button class="home-btn" onclick="showPageSelect()">
    <img src="https://img.icons8.com/clouds/200/paint-palette.png" alt="Coloring Book" />
  </button>
</div>

<div id="library"></div>
<div id="pageSelect"></div>

<div id="drawing">
  <div id="top-bar">
    <button class="top-btn" onclick="undo()">Undo</button>
    <button class="top-btn" onclick="redo()">Redo</button>
    <button class="top-btn" onclick="save()">Save</button>
    <button class="top-btn" onclick="clearCanvas()">Clear</button>
    <button class="top-btn" onclick="download()">Download</button>
  </div>
  <div id="canvas-container">
    <canvas id="drawCanvas" width="800" height="800"></canvas>
  </div>
  <div id="bottom-bar">
    <div class="tool" data-tool="bucket">ðŸª£</div>
    <div class="tool" data-tool="eraser">ðŸ§½</div>
  </div>
</div>

<script>
const drawings = [
  'https://i.postimg.cc/JnZMxXmY/bunny-carrot-coloring-page-600nw-2414476443.jpg',
  'https://i.postimg.cc/cJ6JR6rP/bc2884b1a90b6d9db42580113054c40b.jpg',
  'https://i.postimg.cc/tTxCcfd5/Barbie-6.jpg'
];
const savedImages = [];
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
const img = new Image();
img.crossOrigin = 'anonymous';
let tool = 'bucket';
let color = 'black';
let scale = 1, offsetX = 0, offsetY = 0;
let isDragging = false, dragStartX = 0, dragStartY = 0;
const undoStack = [], redoStack = [];

function showHome() {
  hideAll(); document.getElementById('home').style.display = 'flex';
}
function showLibrary() {
  hideAll();
  const lib = document.getElementById('library');
  lib.style.display = 'flex';
  lib.style.flexWrap = 'wrap';
  lib.innerHTML = '<h2>Saved Images</h2>';
  savedImages.forEach(src => {
    const img = document.createElement('img');
    img.src = src;
    lib.appendChild(img);
  });
  const back = document.createElement('button');
  back.textContent = 'â¬… Back';
  back.onclick = showHome;
  lib.appendChild(back);
}
function showPageSelect() {
  hideAll();
  const ps = document.getElementById('pageSelect');
  ps.style.display = 'flex';
  ps.style.flexWrap = 'wrap';
  ps.innerHTML = '<h2>Select a Drawing</h2>';
  drawings.forEach((src, i) => {
    const thumb = document.createElement('img');
    thumb.src = src;
    thumb.onclick = () => loadPage(i);
    ps.appendChild(thumb);
  });
  const back = document.createElement('button');
  back.textContent = 'â¬… Back';
  back.onclick = showHome;
  ps.appendChild(back);
}
function loadPage(idx) {
  hideAll();
  document.getElementById('drawing').style.display = 'flex';
  img.onload = () => {
    ctx.fillStyle = '#fff';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    pushUndo();
  };
  img.src = drawings[idx] + '?v=' + Date.now();
}
function hideAll() {
  document.querySelectorAll('#home, #library, #pageSelect, #drawing')
    .forEach(el => el.style.display = 'none');
}
document.querySelectorAll('.tool').forEach(el => {
  el.onclick = () => { tool = el.dataset.tool; updateUI(); };
});
const colors = ['black','gray','white','red','orange','yellow','green','blue','purple','pink','brown','#ffe0bd','#ffcd94','#eac086','#d4a373','#c68642'];
colors.forEach(c => {
  const div = document.createElement('div');
  div.className = 'color';
  div.style.background = c;
  div.onclick = () => { color = c; updateUI(); };
  document.getElementById('bottom-bar').appendChild(div);
});
function updateUI() {
  document.querySelectorAll('.tool').forEach(el => el.classList.toggle('active', el.dataset.tool === tool));
  document.querySelectorAll('.color').forEach(el => el.classList.toggle('active', el.style.backgroundColor === color));
}
function getXY(e) {
  const rect = canvas.getBoundingClientRect();
  return {
    x: Math.floor((e.clientX - rect.left - offsetX) / scale),
    y: Math.floor((e.clientY - rect.top - offsetY) / scale)
  };
}
canvas.addEventListener('mousedown', e => {
  isDragging = true;
  dragStartX = e.clientX - offsetX;
  dragStartY = e.clientY - offsetY;
  handleInput(e);
});
canvas.addEventListener('mousemove', e => {
  if (isDragging) {
    offsetX = e.clientX - dragStartX;
    offsetY = e.clientY - dragStartY;
    updateTransform();
  }
});
canvas.addEventListener('mouseup', () => isDragging = false);
canvas.addEventListener('touchstart', e => {
  dragStartX = e.touches[0].clientX - offsetX;
  dragStartY = e.touches[0].clientY - offsetY;
  handleInput(e.touches[0]);
});
canvas.addEventListener('touchmove', e => {
  e.preventDefault();
  offsetX = e.touches[0].clientX - dragStartX;
  offsetY = e.touches[0].clientY - dragStartY;
  updateTransform();
}, { passive: false });
canvas.addEventListener('touchend', () => isDragging = false);
function updateTransform() {
  canvas.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
}
function handleInput(e) {
  const {x, y} = getXY(e);
  if (tool === 'bucket') {
    const imgd = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const rgba = hexToRGBA(color);
    floodfill(imgd.data, x, y, rgba, 20, imgd.width, imgd.height);
    ctx.putImageData(imgd, 0, 0);
    pushUndo();
  } else if (tool === 'eraser') {
    ctx.globalCompositeOperation = 'destination-out';
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, 2 * Math.PI);
    ctx.fill();
    ctx.globalCompositeOperation = 'source-over';
    pushUndo();
  }
}
function hexToRGBA(hex) {
  const tmp = document.createElement('div');
  tmp.style.color = hex;
  document.body.appendChild(tmp);
  const [r, g, b] = getComputedStyle(tmp).color.match(/\d+/g).map(Number);
  document.body.removeChild(tmp);
  return {r, g, b, a: 255};
}
function floodfill(data, sx, sy, fill, tol, w, h) {
  const baseIdx = (sy * w + sx) * 4;
  const baseColor = data.slice(baseIdx, baseIdx + 4);
  const stack = [{x: sx, y: sy}];
  const visited = new Uint8Array(w * h);
  const match = (i) => {
    return Math.abs(data[i]-baseColor[0]) + Math.abs(data[i+1]-baseColor[1]) + Math.abs(data[i+2]-baseColor[2]) < tol;
  };
  while (stack.length) {
    const {x, y} = stack.pop();
    if (x < 0 || x >= w || y < 0 || y >= h) continue;
    const i = (y * w + x) * 4;
    if (visited[y * w + x] || !match(i)) continue;
    visited[y * w + x] = 1;
    data[i] = fill.r; data[i+1] = fill.g; data[i+2] = fill.b; data[i+3] = fill.a;
    stack.push({x:x+1,y}, {x:x-1,y}, {x,y+1}, {x,y-1});
  }
}
function pushUndo() {
  undoStack.push(canvas.toDataURL());
  if (undoStack.length > 50) undoStack.shift();
  redoStack.length = 0;
}
function undo() {
  if (undoStack.length < 2) return;
  redoStack.push(undoStack.pop());
  restore(undoStack[undoStack.length - 1]);
}
function redo() {
  if (!redoStack.length) return;
  const data = redoStack.pop();
  undoStack.push(data);
  restore(data);
}
function restore(src) {
  const img = new Image();
  img.onload = () => ctx.drawImage(img, 0, 0);
  img.src = src;
}
function save() {
  savedImages.push(canvas.toDataURL());
  alert('Saved to Library!');
}
function clearCanvas() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  pushUndo();
}
function download() {
  const a = document.createElement('a');
  a.href = canvas.toDataURL('image/png');
  a.download = 'my_coloring.png';
  a.click();
}

showHome();
</script>
</body>
</html>
