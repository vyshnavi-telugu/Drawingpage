<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Coloring Book App</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      height: 100%;
      width: 100%;
      overflow: hidden;
      touch-action: none;
      background: linear-gradient(to top right, #fff6e0, #ffe4e1);
    }
    body {
      display: flex;
      flex-direction: column;
    }

    #home, #library, #pageSelect, #drawing {
      display: none;
      flex: 1;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    #home {
      background: linear-gradient(to bottom right, #ffdee9, #b5fffc);
    }

    .home-btn {
      margin: 20px;
      border: none;
      background: transparent;
      cursor: pointer;
    }

    .home-btn img {
      width: 180px;
    }

    #pageSelect img, #library img {
      width: 150px;
      margin: 10px;
      border: 3px solid #f06292;
      border-radius: 10px;
      cursor: pointer;
    }

    #top-bar, #bottom-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      background: #ffe0f0;
      padding: 12px;
    }

    button, .tool, .color {
      padding: 10px 14px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: #f06292;
      color: white;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
    }

    .tool, .color {
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .color {
      padding: 0;
      border: 2px solid #f06292;
    }

    .active {
      border: 3px solid #ff4081 !important;
    }

    canvas {
      touch-action: none;
      border-radius: 10px;
      max-width: 100%;
      max-height: 100%;
      background: white;
      transform-origin: 0 0;
      transition: transform 0.2s;
    }

    #canvas-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      position: relative;
      background: #fff;
    }

    #drawCanvas {
      position: absolute;
      left: 0;
      top: 0;
    }
  </style>
</head>
<body>

<div id="home">
  <button class="home-btn" onclick="showLibrary()">
    <img src="https://img.icons8.com/clouds/200/000000/opened-folder.png" alt="Library" />
  </button>
  <button class="home-btn" onclick="showPageSelect()">
    <img src="https://img.icons8.com/clouds/200/paint-palette.png" alt="Coloring Book" />
  </button>
</div>

<div id="library"></div>
<div id="pageSelect"></div>

<div id="drawing">
  <div id="top-bar">
    <button onclick="undo()">Undo</button>
    <button onclick="redo()">Redo</button>
    <button onclick="save()">Save</button>
    <button onclick="download()">Download</button>
    <button onclick="clearCanvas()">Clear</button>
  </div>
  <div id="canvas-container">
    <canvas id="drawCanvas" width="1000" height="1000"></canvas>
  </div>
  <div id="bottom-bar">
    <div class="tool" data-tool="bucket">ðŸª£</div>
    <div class="tool" data-tool="eraser">ðŸ§½</div>
  </div>
</div>

<audio id="clickSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_059f6bff69.mp3?filename=click-124467.mp3"></audio>

<script>
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
const img = new Image();
img.crossOrigin = 'anonymous';

const clickSound = document.getElementById("clickSound");

let tool = 'bucket';
let color = 'black';
let scale = 1, translateX = 0, translateY = 0;
let isDragging = false, dragStart = null;

const drawings = [
  'https://i.postimg.cc/TPZTn08W/0f00c43f3775ba5fcce443f4885aa56e.jpg',
  'https://i.postimg.cc/JnZMxXmY/bunny-carrot-coloring-page-600nw-2414476443.jpg'
];

const savedImages = [];
const undoStack = [], redoStack = [];

function playClick() {
  clickSound.currentTime = 0;
  clickSound.play();
}

function showHome() {
  hideAll();
  document.getElementById('home').style.display = 'flex';
}

function showLibrary() {
  hideAll();
  const lib = document.getElementById('library');
  lib.style.display = 'flex';
  lib.style.flexWrap = 'wrap';
  lib.innerHTML = '<h2>Saved Images</h2>';
  savedImages.forEach(src => {
    const img = document.createElement('img');
    img.src = src;
    lib.appendChild(img);
  });
  const back = document.createElement('button');
  back.textContent = 'â¬… Back';
  back.onclick = showHome;
  lib.appendChild(back);
}

function showPageSelect() {
  hideAll();
  const ps = document.getElementById('pageSelect');
  ps.style.display = 'flex';
  ps.style.flexWrap = 'wrap';
  ps.innerHTML = '<h2>Select a Drawing</h2>';
  drawings.forEach((src, i) => {
    const thumb = document.createElement('img');
    thumb.src = src;
    thumb.onclick = () => loadPage(i);
    ps.appendChild(thumb);
  });
  const back = document.createElement('button');
  back.textContent = 'â¬… Back';
  back.onclick = showHome;
  ps.appendChild(back);
}

function loadPage(idx) {
  hideAll();
  document.getElementById('drawing').style.display = 'flex';
  img.onload = () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    pushUndo();
  };
  img.src = drawings[idx] + '?v=' + Date.now();
}

function hideAll() {
  ['home', 'library', 'pageSelect', 'drawing'].forEach(id => {
    document.getElementById(id).style.display = 'none';
  });
}

document.querySelectorAll('.tool').forEach(el => {
  el.onclick = () => {
    playClick();
    tool = el.dataset.tool;
    updateUI();
  };
});

['black','red','yellow','green','blue','white'].forEach(c => {
  const div = document.createElement('div');
  div.className = 'color';
  div.style.background = c;
  div.onclick = () => { playClick(); color = c; updateUI(); };
  document.getElementById('bottom-bar').appendChild(div);
});

function updateUI() {
  document.querySelectorAll('.tool').forEach(el => el.classList.toggle('active', el.dataset.tool === tool));
  document.querySelectorAll('.color').forEach(el => el.classList.toggle('active', el.style.background === color));
}

canvas.addEventListener('mousedown', startDrag);
canvas.addEventListener('mousemove', dragMove);
canvas.addEventListener('mouseup', endDrag);
canvas.addEventListener('click', handlePaint);
canvas.addEventListener('touchstart', e => handlePaint(e.touches[0]));
canvas.addEventListener('touchmove', pinchZoomMove, { passive: false });
canvas.addEventListener('touchend', () => { lastDist = null; });

let lastDist = null;
function pinchZoomMove(e) {
  if (e.touches.length === 2) {
    e.preventDefault();
    const dx = e.touches[0].clientX - e.touches[1].clientX;
    const dy = e.touches[0].clientY - e.touches[1].clientY;
    const dist = Math.sqrt(dx * dx + dy * dy);
    if (lastDist) {
      scale *= dist / lastDist;
      scale = Math.max(0.3, Math.min(scale, 3));
      applyTransform();
    }
    lastDist = dist;
  }
}

function startDrag(e) {
  if (e.touches?.length === 2) return;
  dragStart = { x: e.clientX, y: e.clientY };
  isDragging = true;
}

function dragMove(e) {
  if (!isDragging) return;
  translateX += e.clientX - dragStart.x;
  translateY += e.clientY - dragStart.y;
  dragStart = { x: e.clientX, y: e.clientY };
  applyTransform();
}

function endDrag() {
  isDragging = false;
}

function applyTransform() {
  canvas.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
}

function handlePaint(e) {
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left - translateX) / scale);
  const y = Math.floor((e.clientY - rect.top - translateY) / scale);

  if (tool === 'bucket') {
    playClick();
    const imgd = ctx.getImageData(0, 0, canvas.width, canvas.height);
    floodfill(imgd.data, x, y, hexToRGBA(color), 25, imgd.width, imgd.height);
    ctx.putImageData(imgd, 0, 0);
    pushUndo();
  } else if (tool === 'eraser') {
    ctx.globalCompositeOperation = 'destination-out';
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, 2 * Math.PI);
    ctx.fill();
    ctx.globalCompositeOperation = 'source-over';
    pushUndo();
  }
}

function floodfill(data, sx, sy, fill, tol, w, h) {
  const index = (sy * w + sx) * 4;
  const base = data.slice(index, index + 4);
  const stack = [{x: sx, y: sy}], visited = new Uint8Array(w * h);
  const match = px => px.every((v, i) => Math.abs(v - base[i]) < tol);

  while (stack.length) {
    const {x, y} = stack.pop();
    if (x < 0 || x >= w || y < 0 || y >= h) continue;
    const i = (y * w + x) * 4;
    if (visited[y * w + x] || !match(data.slice(i, i + 4))) continue;
    visited[y * w + x] = 1;
    [data[i], data[i+1], data[i+2], data[i+3]] = [fill.r, fill.g, fill.b, fill.a];
    stack.push({x: x+1, y}, {x: x-1, y}, {x, y: y+1}, {x, y: y-1});
  }
}

function hexToRGBA(hex) {
  const tmp = document.createElement('div');
  tmp.style.color = hex;
  document.body.appendChild(tmp);
  const [r, g, b] = getComputedStyle(tmp).color.match(/\d+/g).map(Number);
  document.body.removeChild(tmp);
  return {r, g, b, a: 255};
}

function pushUndo() {
  undoStack.push(canvas.toDataURL());
  if (undoStack.length > 30) undoStack.shift();
  redoStack.length = 0;
}

function undo() {
  if (undoStack.length < 2) return;
  redoStack.push(undoStack.pop());
  restore(undoStack[undoStack.length - 1]);
}

function redo() {
  if (!redoStack.length) return;
  const data = redoStack.pop();
  undoStack.push(data);
  restore(data);
}

function restore(src) {
  const image = new Image();
  image.onload = () => ctx.drawImage(image, 0, 0);
  image.src = src;
}

function save() {
  const data = canvas.toDataURL();
  savedImages.push(data);
  alert('Saved to library!');
}

function download() {
  const link = document.createElement('a');
  link.download = 'coloring.png';
  link.href = canvas.toDataURL();
  link.click();
}

function clearCanvas() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  if (img.src) ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
  pushUndo();
}

showHome();
</script>
</body>
</html>
