<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Coloring App</title>
  <style>
    html,body{margin:0;padding:0;height:100%;overflow:hidden;touch-action:none;font-family:Comic Sans MS;background:#fff6e0}
    #home,#library,#pageSelect,#drawing{display:none;flex-direction:column;width:100%;height:100%}
    #home{display:flex;justify-content:space-around;align-items:center;padding:20px;background:linear-gradient(to bottom right,#ffdee9,#b5fffc)}
    .home-btn{width:160px;text-align:center}
    .home-btn img{width:100%;display:block;margin-bottom:6px}
    .home-btn div{font-weight:bold}
    #library h2,#pageSelect h2{font-size:24px;font-weight:bold;padding:8px;text-align:center}
    #library,#pageSelect{flex:1;overflow:auto;align-items:center;padding:10px}
    #library img,#pageSelect img{width:150px;margin:10px;border:3px solid #f06292;border-radius:10px;cursor:pointer}
    .thumb-container{position:relative; display:inline-block; margin:10px;}
    .delete-btn{position:absolute;top:4px;right:4px;padding:2px 6px;font-size:12px;background:red;color:white;border:none;border-radius:4px;cursor:pointer;}
    #drawing{display:flex;flex-direction:column;height:100%;position:relative}
    #backBtn{position:absolute;top:10px;left:10px;padding:6px;font-size:16px;z-index:10}
    #top-bar{display:flex;flex-wrap:wrap;gap:8px;padding:8px;background:#ffe0f0;justify-content:center}
    #canvas-container{flex:1;position:relative;overflow:hidden;background:#fff}
    canvas{display:block;touch-action:none;border-radius:10px}
    #bottom-bar{display:flex;gap:8px;overflow-x:auto;background:#ffe0f0;padding:8px;border-top:2px solid #ccc;box-shadow:inset 0 5px 5px -5px rgba(0,0,0,0.3)}
    button,.tool,.color{padding:6px;font-size:16px;border:none;border-radius:10px;cursor:pointer;background:#f06292;color:#fff;box-shadow:2px 2px 6px rgba(0,0,0,0.2);flex-shrink:0}
    .tool,.color{width:36px;height:36px;display:flex;align-items:center;justify-content:center}
    .color{border:3px solid #333}
    .active{border:3px solid #ff4081!important}
    #libBack{padding:6px;font-size:16px;margin:10px;align-self:flex-start}
  </style>
</head>
<body>

<div id="home">
  <button class="home-btn" onclick="showPageSelect()">
    <img src="https://img.icons8.com/clouds/200/000000/paint-palette.png"/><div>Coloring Book</div>
  </button>
  <button class="home-btn" onclick="showLibrary()">
    <img src="https://img.icons8.com/clouds/200/000000/opened-folder.png"/><div>My Album</div>
  </button>
</div>

<div id="pageSelect">
  <h2>Coloring Book</h2>
  <div id="pages" style="display:flex;flex-wrap:wrap;justify-content:center"></div>
</div>

<div id="library">
  <h2>My Album</h2>
  <div id="savedImgs" style="display:flex;flex-wrap:wrap;justify-content:center"></div>
  <button id="libBack" onclick="showHome()">â¬… Back</button>
</div>

<div id="drawing">
  <button id="backBtn" onclick="showHome()">â¬…</button>
  <div id="top-bar">
    <button onclick="undo()">âŽŒ Undo</button>
    <button onclick="redo()">â†» Redo</button>
    <button onclick="save()">ðŸ’¾ Save</button>
    <button onclick="download()">â¬‡ Download</button>
    <button onclick="clearCanvas()">ðŸ—‘ Clear</button>
  </div>
  <div id="canvas-container"><canvas id="canvas"></canvas></div>
  <div id="bottom-bar">
    <div class="tool" data-tool="bucket">ðŸª£</div>
    <div class="tool" data-tool="eraser">ðŸ§½</div>
  </div>
</div>

<audio id="clickSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_059f6bff69.mp3?filename=click-124467.mp3"></audio>

<script>
const STORAGE_KEY='myColorLib';
let saved = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
const canvas=document.getElementById('canvas'), ctx=canvas.getContext('2d');
const img=new Image(); img.crossOrigin='anonymous';
const clickSound=document.getElementById('clickSound');

let tool='bucket',color='black',scale=1,tx=0,ty=0,isDrag=false,start=null,lastDist=null;
const undoStack=[],redoStack=[];
const colors=['blue','skyblue','cyan','indigo','purple','violet','brown','red','orange','yellow','green','dark green','pink','light pink','skin','black','white','grey'];
const drawings=[
  'https://i.postimg.cc/TPZTn08W/0f00c43f3775ba5fcce443f4885aa56e.jpg',
  'https://i.postimg.cc/JnZMxXmY/bunny-carrot-coloring-page-600nw-2414476443.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/pLsT5KXD/6331b296558cf1f8f7fd87cc9154f432.jpg',
  'https://i.postimg.cc/2yYmK5Sk/7113dc553901fe5719b2c9e221449e28.jpg',
  'https://i.postimg.cc/MKxKs9n7/adorable-fun-kids-coloring-page-delight-freepik-908673-3027.jpg',
  'https://i.postimg.cc/MKxKs9n7/adorable-fun-kids-coloring-page-delight-freepik-908673-3027.jpg',
  'https://i.postimg.cc/jS1TrcSk/Barbie-10.jpg',
  'https://i.postimg.cc/FsDmTN5v/Barbie-24.jpg',
  'https://i.postimg.cc/FsDmTN5v/Barbie-24.jpg',
  'https://i.postimg.cc/j2YdYXZr/Barbie-27.jpg',
  'https://i.postimg.cc/tTxCcfd5/Barbie-6.jpg'
];

function init(){
  const pages=document.getElementById('pages');
  drawings.forEach((src,i)=>{
    const im=document.createElement('img');
    im.src=src;
    im.onclick=()=>loadPage(i);
    pages.appendChild(im);
  });
  renderLibrary();
  const bottom=document.getElementById('bottom-bar');
  colors.forEach(c=>{
    const d=document.createElement('div');
    d.className='color'; d.style.background=c;
    d.onclick=()=>{color=c;updateUI();clickSound.currentTime=0;clickSound.play()};
    bottom.appendChild(d);
  });
  document.querySelectorAll('.tool').forEach(t=>{
    t.onclick=()=>{
      tool=t.dataset.tool; updateUI(); clickSound.currentTime=0; clickSound.play();
    };
  });
  updateUI();
  window.addEventListener('resize',resizeCanvas);
  showHome();
}

function renderLibrary(){
  const div=document.getElementById('savedImgs');
  div.innerHTML='';
  saved.forEach((src,i)=>{
    const cont=document.createElement('div');
    cont.className='thumb-container';
    const im=document.createElement('img'); im.src=src;
    const del=document.createElement('button');
    del.className='delete-btn'; del.textContent='X';
    del.onclick=()=>{
      saved.splice(i,1);
      localStorage.setItem(STORAGE_KEY, JSON.stringify(saved)); renderLibrary();
    };
    cont.appendChild(im); cont.appendChild(del); div.appendChild(cont);
  });
}

function hideAll(){['home','drawing','library','pageSelect'].forEach(id=>document.getElementById(id).style.display='none');}
function showHome(){hideAll();document.getElementById('home').style.display='flex'}
function showLibrary(){hideAll();renderLibrary();document.getElementById('library').style.display='flex'}
function showPageSelect(){hideAll();document.getElementById('pageSelect').style.display='flex'}

function loadPage(i){
  hideAll(); document.getElementById('drawing').style.display='flex';
  img.onload=()=>{
    resizeCanvas(); reset(); drawImageScaled(); push();
  };
  img.src=drawings[i]+'?v='+Date.now();
}

function resizeCanvas(){
  const r=document.getElementById('canvas-container').getBoundingClientRect();
  canvas.width=r.width; canvas.height=r.height;
}

function reset(){scale=1; tx=0; ty=0; canvas.style.transform='';}
function updateUI(){
  document.querySelectorAll('.tool').forEach(el=>el.classList.toggle('active',el.dataset.tool===tool));
  document.querySelectorAll('.color').forEach(el=>el.classList.toggle('active',el.style.background===color));
}

canvas.onmousedown=e=>{isDrag=true; start={x:e.clientX,y:e.clientY};};
canvas.onmousemove=e=>{if(isDrag){tx+=e.clientX-start.x;ty+=e.clientY-start.y;start={x:e.clientX,y:e.clientY};apply();}};
canvas.onmouseup=canvas.onmouseleave=_=>isDrag=false;
canvas.addEventListener('touchstart',e=>{
  if(e.touches.length===1){isDrag=true; start={x:e.touches[0].clientX,y:e.touches[0].clientY};}
  else if(e.touches.length===2){lastDist=getDist(e);start=getMid(e);}
});
canvas.addEventListener('touchmove',e=>{
  e.preventDefault();
  if(e.touches.length===1&&isDrag){
    tx+=e.touches[0].clientX-start.x; ty+=e.touches[0].clientY-start.y;
    start={x:e.touches[0].clientX,y:e.touches[0].clientY}; apply();
  } else if(e.touches.length===2){
    const nd=getDist(e), m=getMid(e);
    let f=1+(nd/lastDist-1)/10;
    const bx=(m.x-tx)/scale, by=(m.y-ty)/scale;
    scale*=f; tx=m.x-bx*scale; ty=m.y-by*scale; lastDist=nd; apply();
  }
},{passive:false});
canvas.addEventListener('touchend',_=>{isDrag=false;if((event.touches||[]).length<2) lastDist=null;});
canvas.onclick=e=>{
  if(!img.src) return;
  const rect=canvas.getBoundingClientRect();
  const sx=e.clientX-rect.left, sy=e.clientY-rect.top;
  const inv=ctx.getTransform().invertSelf();
  const pt=inv.transformPoint(new DOMPoint(sx- tx, sy- ty));
  const x=Math.floor(pt.x), y=Math.floor(pt.y);
  clickSound.currentTime=0; clickSound.play();
  const id=ctx.getImageData(0,0,canvas.width,canvas.height), d=id.data;
  const bg={r:255,g:246,b:224,a:255};
  if(tool==='bucket') flood(d,x,y,hex(c),25,canvas.width,canvas.height);
  else flood(d,x,y,bg,25,canvas.width,canvas.height);
  ctx.putImageData(id,0,0); push();
};

function getDist(e){return Math.hypot(e.touches[0].clientX-e.touches[1].clientX, e.touches[0].clientY-e.touches[1].clientY);}
function getMid(e){return {x:(e.touches[0].clientX+e.touches[1].clientX)/2, y:(e.touches[0].clientY+e.touches[1].clientY)/2};}
function apply(){canvas.style.transform=`translate(${tx}px,${ty}px) scale(${scale})`;canvas.style.transformOrigin='0 0';}

function flood(data,x,y,c,t,w,h){
  const si=(y*w+x)*4, base=data.slice(si,si+4);
  const match=px=>px.every((v,i)=>Math.abs(v-base[i])<t);
  const st=[{x,y}], vis=new Uint8Array(w*h);
  while(st.length){
    const p=st.pop(), i=(p.y*w+p.x)*4;
    if(p.x<0||p.x>=w||p.y<0||p.y>=h||vis[p.y*w+p.x]||!match(data.slice(i,i+4))) continue;
    vis[p.y*w+p.x]=1;
    data[i]=c.r;data[i+1]=c.g;data[i+2]=c.b;data[i+3]=c.a;
    st.push({x:p.x+1,y:p.y},{x:p.x-1,y:p.y},{x:p.x,y:p.y+1},{x:p.x,y:p.y-1});
  }
}

function hex(c){
  const tmp=document.createElement('div');tmp.style.color=c;document.body.appendChild(tmp);
  const [r,g,b]=getComputedStyle(tmp).color.match(/\d+/g).map(Number);
  document.body.removeChild(tmp);
  return {r,g,b,a:255};
}

function drawImageScaled(){
  const cw=canvas.width,ch=canvas.height, iw=img.width, ih=img.height;
  const r=Math.min(cw/iw,ch/ih), x=(cw-iw*r)/2, y=(ch-ih*r)/2;
  ctx.setTransform(1,0,0,1,0,0);
  ctx.clearRect(0,0,cw,ch);
  ctx.drawImage(img,0,0,iw,ih,x,y,iw*r,ih*r);
}

function push(){
  undoStack.push(canvas.toDataURL());
  if(undoStack.length>30) undoStack.shift();
  redoStack.length=0;
}
function undo(){if(undoStack.length<2)return;redoStack.push(undoStack.pop());restore(undoStack.at(-1));}
function redo(){if(!redoStack.length)return;const d=redoStack.pop();undoStack.push(d);restore(d);}
function restore(src){
  const i=new Image();i.onload=()=>{ctx.drawImage(i,0,0);reset();apply();};i.src=src;
}

function save(){
  saved.push(canvas.toDataURL());
  localStorage.setItem(STORAGE_KEY,JSON.stringify(saved));
  renderLibrary();
  alert('Saved!');
}
function download(){
  const a=document.createElement('a');
  a.href=canvas.toDataURL(); a.download='coloring.png'; a.click();
}
function clearCanvas(){
  drawImageScaled(); push();
}

init();
</script>
</body>
</html>
