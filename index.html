<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Coloring Book â€“ No Zoom</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <style>
    html, body {
      margin:0; padding:0; height:100%;
      touch-action: manipulation; /* block double-finger zoom */
      font-family: sans-serif;
    }
    body { display:flex; }
    #sidebar { width:250px; background:#f0f0f0; padding:10px; }
    #canvas-wrap { flex:1; display:flex; align-items:center; justify-content:center; }
    canvas { border:1px solid #ccc; cursor:crosshair; }
    .tool, .color, .btn {
      margin:5px; padding:5px; cursor:pointer; display:inline-block;
    }
    .active { border:2px solid red !important; }
    .color { width:24px; height:24px; }
  </style>
</head>
<body>
  <div id="sidebar">
    <h4>Pages</h4><div id="pages"></div>
    <h4>Tools</h4>
    <div id="tools">
      <div class="tool" data-tool="brush">Brush</div>
      <div class="tool" data-tool="crayon">Crayon</div>
      <div class="tool" data-tool="bucket">Bucket</div>
      <div class="tool" data-tool="eraser">Eraser</div>
    </div>
    <h4>Colors</h4><div id="colors"></div>
    <div>
      <button id="undo" class="btn">Undo</button>
      <button id="redo" class="btn">Redo</button>
      <button id="save" class="btn">Save Dwg</button>
    </div>
  </div>
  <div id="canvas-wrap"><canvas id="drawCanvas" width="600" height="600"></canvas></div>

  <script>
    const drawings = [
     'https://i.postimg.cc/TPZTn08W/0f00c43f3775ba5fcce443f4885aa56e.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/pLsT5KXD/6331b296558cf1f8f7fd87cc9154f432.jpg',
    'https://i.postimg.cc/2yYmK5Sk/7113dc553901fe5719b2c9e221449e28.jpg',
    'https://i.postimg.cc/MKxKs9n7/adorable-fun-kids-coloring-page-delight-freepik-908673-3027.jpg',
    'https://i.postimg.cc/jS1TrcSk/Barbie-10.jpg',
    'https://i.postimg.cc/FsDmTN5v/Barbie-24.jpg',
    'https://i.postimg.cc/j2YdYXZr/Barbie-27.jpg',
  'https://i.postimg.cc/cJ6JR6rP/bc2884b1a90b6d9db42580113054c40b.jpg', 
    ];
    const canvas = document.getElementById('drawCanvas');
    const ctx = canvas.getContext('2d');
    ctx.lineCap = 'round';
    let tool = 'brush', color = 'black', isDrawing = false, points = [];
    let img = new Image(), undoStack = [], redoStack = [];
    const toolsEl = document.getElementById('tools');
    const colorsEl = document.getElementById('colors');
    const pagesEl = document.getElementById('pages');

    // Load pages
    drawings.forEach((src,i) => {
      const btn = document.createElement('button');
      btn.textContent = 'Page ' + (i+1);
      btn.onclick = () => loadPage(i, true);
      pagesEl.appendChild(btn);
    });

    ['brush','crayon','bucket','eraser'].forEach(t => {
      const el = document.querySelector(`.tool[data-tool="${t}"]`);
      el.onclick = () => { tool = t; updateUI(); };
    });

    ['black','red','green','blue','orange'].forEach(c => {
      const div = document.createElement('div');
      div.className = 'color';
      div.style.background = c;
      div.onclick = () => { color = c; updateUI(); };
      colorsEl.appendChild(div);
    });

    document.getElementById('undo').onclick = undo;
    document.getElementById('redo').onclick = redo;
    document.getElementById('save').onclick = () => {
      const a = document.createElement('a');
      a.href = canvas.toDataURL();
      a.download = 'drawing.png';
      a.click();
    };

    updateUI();
    loadPage(0, false);

    canvas.onmousedown = e => {
      const {x,y} = getXY(e);
      if (tool === 'bucket') {
        const imgd = ctx.getImageData(0,0,canvas.width,canvas.height);
        const rgba = hexToRGBA(color);
        floodfill(imgd.data, x, y, rgba, 128, imgd.width, imgd.height);
        ctx.putImageData(imgd, 0, 0);
        pushUndo();
      } else {
        isDrawing = true;
        points = [{x,y}];
      }
    };

    canvas.onmousemove = e => {
      if (!isDrawing) return;
      const {x,y} = getXY(e);
      points.push({x,y});
      redrawStroke();
    };

    canvas.onmouseup = () => {
      if (isDrawing) { pushUndo(); isDrawing = false; }
    };

    function redrawStroke(){
      const temp = ctx.getImageData(0,0,canvas.width,canvas.height);
      ctx.putImageData(temp, 0, 0);
      ctx.beginPath();
      if (points.length < 3) {
        const p = points[0];
        ctx.arc(p.x, p.y, 1, 0, Math.PI*2);
        if (tool==='eraser') ctx.fillStyle = 'white';
        ctx.fill();
        return;
      }
      ctx.strokeStyle = (tool === 'eraser' ? 'white' : color);
      ctx.lineWidth = (tool === 'brush' ? 5 : tool === 'crayon' ? 15 : 20);
      ctx.globalAlpha = (tool === 'crayon' ? 0.3 : 1);
      ctx.moveTo(points[0].x, points[0].y);
      for (let i = 1; i < points.length - 2; i++) {
        const xc = (points[i].x + points[i+1].x)/2;
        const yc = (points[i].y + points[i+1].y)/2;
        ctx.quadraticCurveTo(points[i].x, points[i].y, xc, yc);
      }
      const last = points[points.length-1];
      const sl = points[points.length-2];
      ctx.quadraticCurveTo(sl.x, sl.y, last.x, last.y);
      ctx.stroke();
      ctx.globalAlpha = 1;
    }

    function getXY(e) {
      const r = canvas.getBoundingClientRect();
      return { x: e.clientX - r.left, y: e.clientY - r.top };
    }

    function updateUI(){
      document.querySelectorAll('.tool').forEach(el => el.classList.toggle('active', el.dataset.tool===tool));
      document.querySelectorAll('.color').forEach(el => el.classList.toggle('active', el.style.background===color));
    }

    function loadPage(idx, clearHistory){
      if (clearHistory) { undoStack=[]; redoStack=[]; }
      img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = () => {
        ctx.fillStyle = '#fff';
        ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img,0,0,canvas.width,canvas.height);
        pushUndo();
      };
      img.src = drawings[idx];
    }

    function pushUndo(){
      undoStack.push(canvas.toDataURL());
      if (undoStack.length > 50) undoStack.shift();
      redoStack = [];
    }

    function undo(){
      if (undoStack.length < 2) return;
      redoStack.push(undoStack.pop());
      restore(undoStack[undoStack.length-1]);
    }

    function redo(){
      if (!redoStack.length) return;
      const data = redoStack.pop();
      undoStack.push(data);
      restore(data);
    }

    function restore(src){
      const img2 = new Image();
      img2.onload = () => ctx.drawImage(img2, 0, 0);
      img2.src = src;
    }

    function floodfill(data, sx, sy, fill, tol, w, h){
      const stack = [ {x: sx, y: sy} ];
      const baseIdx = (sy*w + sx)*4;
      const base = data.slice(baseIdx, baseIdx+4);
      const match = px => (
        Math.abs(px[0]-base[0])<=tol &&
        Math.abs(px[1]-base[1])<=tol &&
        Math.abs(px[2]-base[2])<=tol &&
        Math.abs(px[3]-base[3])<=tol
      );
      while (stack.length) {
        const {x, y} = stack.pop();
        let nx = x;
        while (nx >= 0 && match(data.slice((y*w+nx)*4, (y*w+nx)*4+4))) nx--;
        nx++;
        let spanUp=false, spanDn=false;
        for (let xi = nx; xi < w && match(data.slice((y*w+xi)*4, (y*w+xi)*4+4)); xi++){
          const pi = (y*w + xi)*4;
          data[pi] = fill.r; data[pi+1] = fill.g;
          data[pi+2] = fill.b; data[pi+3] = fill.a;
          if (!spanUp && y>0) {
            if (match(data.slice(((y-1)*w+xi)*4, ((y-1)*w+xi)*4+4))) {
              stack.push({x:xi, y:y-1}); spanUp=true;
            }
          }
          if (!spanDn && y<h-1) {
            if (match(data.slice(((y+1)*w+xi)*4, ((y+1)*w+xi)*4+4))){
              stack.push({x:xi, y:y+1}); spanDn=true;
            }
          }
        }
      }
    }

    function hexToRGBA(hex){
      const tmp = document.createElement('div');
      tmp.style.color = hex;
      document.body.appendChild(tmp);
      const [r,g,b] = getComputedStyle(tmp).color.match(/\d+/g).map(Number);
      document.body.removeChild(tmp);
      return { r, g, b, a:255 };
    }
  </script>
</body>
</html>
