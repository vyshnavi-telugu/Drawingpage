<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Coloring Book App</title>
  <style>
    html, body {
      margin:0; padding:0;
      height:100%; width:100%;
      overflow:hidden;
      font-family:sans-serif;
    }
    #home, #library, #pageSelect, #drawing {
      display:none;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      height:100%;
      width:100%;
    }
    body { display:flex; }
    #home {
      background: url('...Rangoli_Design.jpg') center/cover no-repeat;
    }
    .home-btn {
      margin:20px; border:none;
      background:none; cursor:pointer;
      text-align:center;
      color:#fff; text-shadow:1px 1px 2px rgba(0,0,0,0.7);
    }
    .home-btn img { width:200px; height:auto; }
    #library, #pageSelect {
      display:flex; flex-wrap:wrap; overflow:auto;
      padding:10px;
    }
    #pageSelect img, #library img {
      width:150px; margin:5px; border:2px solid #333;
      cursor:pointer;
    }
    #drawing {
      display:flex; flex-direction:column;
      width:100%; height:100%;
    }
    #top-bar, #bottom-bar {
      display:flex; justify-content:center;
      align-items:center; background:#eee;
      padding:5px;
      z-index:2;
    }
    #top-bar button, #bottom-bar .tool, #bottom-bar .color {
      margin:4px; padding:6px;
      border:1px solid #333; border-radius:4px;
      font-size:20px; cursor:pointer;
    }
    #bottom-bar .color {
      width:28px; height:28px;
    }
    canvas {
      flex:1;
      border:1px solid #ccc;
      touch-action: none;
      user-select:none;
      transform-origin:0 0;
      background:#fff;
    }
    .active { border:2px solid red !important; }
    #undoBtn { color:skyblue; }
    #redoBtn { color:skyblue; }
    #saveBtn { color:green; }
    #deleteBtn { color:red; }
    #downloadBtn { color:goldenrod; }
  </style>
</head>
<body>
  <div id="home">
    <button class="home-btn" onclick="showLibrary()">
      <img src="https://img.icons8.com/clouds/200/000000/opened-folder.png"><br>Library
    </button>
    <button class="home-btn" onclick="showPageSelect()">
      <img src="https://img.icons8.com/clouds/200/paint-palette.png"><br>Coloring Book
    </button>
  </div>
  <div id="library"></div>
  <div id="pageSelect"></div>
  <div id="drawing">
    <div id="top-bar">
      <button id="undoBtn">Undo</button>
      <button id="redoBtn">Redo</button>
      <button id="saveBtn">Save</button>
      <button id="deleteBtn">Delete</button>
      <button id="downloadBtn">Download</button>
    </div>
    <canvas id="drawCanvas" width="600" height="600"></canvas>
    <div id="bottom-bar"></div>
  </div>

  <script>
    const drawings = [
      'https://i.postimg.cc/TPZTn08W/0f00c43f3775ba5fcce443f4885aa56e.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/pLsT5KXD/6331b296558cf1f8f7fd87cc9154f432.jpg',
    'https://i.postimg.cc/2yYmK5Sk/7113dc553901fe5719b2c9e221449e28.jpg',
    'https://i.postimg.cc/MKxKs9n7/adorable-fun-kids-coloring-page-delight-freepik-908673-3027.jpg',
    'https://i.postimg.cc/jS1TrcSk/Barbie-10.jpg',
    'https://i.postimg.cc/FsDmTN5v/Barbie-24.jpg',
    'https://i.postimg.cc/j2YdYXZr/Barbie-27.jpg',
  'https://i.postimg.cc/cJ6JR6rP/bc2884b1a90b6d9db42580113054c40b.jpg',
    ];
    const savedImages = [];
    const canvas = document.getElementById('drawCanvas');
    const ctx = canvas.getContext('2d');
    const img = new Image();
    img.crossOrigin = 'anonymous';
    let tool='bucket', color='black';
    let scale=1, startDist=0, origScale=1;
    let pan={x:0,y:0}, startPan={x:0,y:0};
    let isPanning=false;
    const undoStack=[], redoStack=[];

    // UI
    document.getElementById('undoBtn').onclick=undo;
    document.getElementById('redoBtn').onclick=redo;
    document.getElementById('saveBtn').onclick=save;
    document.getElementById('deleteBtn').onclick=()=>{
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img,0,0,canvas.width,canvas.height);
      pushUndo();
    };
    document.getElementById('downloadBtn').onclick=()=>{
      const a=document.createElement('a');
      a.href=canvas.toDataURL(); a.download='coloring.png';
      a.click();
    };

    function showLibrary(){
      hideAll(); const lib=document.getElementById('library');
      lib.style.display='flex'; lib.innerHTML='<h2>Saved Images</h2>';
      savedImages.forEach(src=>{
        const i = document.createElement('img'); i.src=src;
        lib.appendChild(i);
      });
      const b=document.createElement('button'); b.textContent='â¬… Back';
      b.onclick=showHome; lib.appendChild(b);
    }
    function showPageSelect(){
      hideAll(); const ps=document.getElementById('pageSelect');
      ps.style.display='flex'; ps.innerHTML='<h2>Select a Drawing</h2>';
      drawings.forEach((src,i)=>{
        const t=document.createElement('img'); t.src=src;
        t.onclick=()=>loadPage(i); ps.appendChild(t);
      });
      const b=document.createElement('button'); b.textContent='â¬… Back';
      b.onclick=showHome; ps.appendChild(b);
    }
    function loadPage(idx){
      hideAll(); document.getElementById('drawing').style.display='flex';
      img.onload=()=>{
        scale=1; pan={x:0,y:0}; applyTransform();
        ctx.fillStyle='#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(img,0,0,canvas.width,canvas.height);
        pushUndo();
      };
      img.src=drawings[idx]+'?v='+Date.now();
    }
    function showHome(){ hideAll(); document.getElementById('home').style.display='flex'; }
    function hideAll(){
      ['home','library','pageSelect','drawing']
        .forEach(id=>document.getElementById(id).style.display='none');
    }

    // Tools & Colors
    const bottom = document.getElementById('bottom-bar');
    ['bucket','eraser'].forEach(t=>{
      const btn=document.createElement('div');
      btn.className='tool'; btn.dataset.tool=t;
      btn.textContent = t==='bucket'?'ðŸª£':'ðŸ§½';
      btn.onclick=()=>{tool=t;updateUI()};
      bottom.appendChild(btn);
    });
    ['black','red','green','blue','yellow','#ffe0bd','#ffcd94'].forEach(c=>{
      const d=document.createElement('div');
      d.className='color'; d.style.background=c;
      d.onclick=()=>{ color=c; updateUI(); };
      bottom.appendChild(d);
    });
    function updateUI(){
      document.querySelectorAll('.tool').forEach(el=>el.classList.toggle('active', el.dataset.tool===tool));
      document.querySelectorAll('.color').forEach(el=>el.classList.toggle('active', el.style.background===color));
    }

    function pushUndo(){
      undoStack.push(canvas.toDataURL());
      if(undoStack.length>50) undoStack.shift();
      redoStack.length=0;
    }
    function restore(src){
      const im=new Image();
      im.onload=()=>ctx.drawImage(im,0,0);
      im.src=src;
    }
    function undo(){
      if(undoStack.length<2) return;
      redoStack.push(undoStack.pop());
      restore(undoStack[undoStack.length-1]);
    }
    function redo(){
      if(!redoStack.length)return;
      const d=redoStack.pop();
      undoStack.push(d); restore(d);
    }
    function save(){
      savedImages.push(canvas.toDataURL());
      alert('Saved to library!');
    }

    // Touch & Mouse interaction with zoom & pan
    function getXY(e){
      const rect = canvas.getBoundingClientRect();
      const x=(e.clientX-rect.left-pan.x)/scale;
      const y=(e.clientY-rect.top-pan.y)/scale;
      return {x:Math.floor(x), y:Math.floor(y)};
    }
    function handleInput(x,y){
      if(tool==='bucket'){
        const imgd=ctx.getImageData(0,0,canvas.width,canvas.height);
        floodfill(imgd.data, x,y, hexToRGBA(color), 60, imgd.width, imgd.height);
        ctx.putImageData(imgd,0,0); pushUndo();
      } else {
        ctx.globalCompositeOperation='destination-out';
        ctx.beginPath(); ctx.arc(x,y,10,0,2*Math.PI); ctx.fill();
        ctx.globalCompositeOperation='source-over'; pushUndo();
      }
    }

    canvas.addEventListener('pointerdown', e=>{
      canvas.setPointerCapture(e.pointerId);
      if(e.pointerType==='touch'){
        pointers[e.pointerId]=e;
        if(Object.keys(pointers).length===2){
          const [p1,p2]=Object.values(pointers);
          startDist = Math.hypot(p1.clientX-p2.clientX, p1.clientY-p2.clientY);
          origScale = scale;
        }
      } else {
        isPanning = true;
        startPan = {x:e.clientX-pan.x, y:e.clientY-pan.y};
      }
    });
    canvas.addEventListener('pointermove', e=>{
      if(e.pointerType==='touch'){
        pointers[e.pointerId]=e;
        if(Object.keys(pointers).length===2){
          const [p1,p2]=Object.values(pointers);
          const currDist = Math.hypot(p1.clientX-p2.clientX, p1.clientY-p2.clientY);
          scale = Math.min(3, Math.max(0.4, origScale * currDist / startDist));
          const midX = (p1.clientX+p2.clientX)/2;
          const midY = (p1.clientY+p2.clientY)/2;
          pan.x = midX - (midX - pan.x)* (scale/origScale);
          pan.y = midY - (midY - pan.y)* (scale/origScale);
          applyTransform();
        }
      } else if(isPanning){
        pan.x = e.clientX - startPan.x;
        pan.y = e.clientY - startPan.y;
        applyTransform();
      }
    });
    canvas.addEventListener('pointerup', e=>{
      canvas.releasePointerCapture(e.pointerId);
      delete pointers[e.pointerId];
      if(e.pointerType!=='touch') isPanning=false;
    });
    canvas.addEventListener('click', e=>{
      if(scale===1 && !isPanning){
        const {x,y} = getXY(e);
        handleInput(x,y);
      }
    });

    const pointers = {};

    // Flood fill helpers (unchanged)
    function hexToRGBA(hex){
      const tmp=document.createElement('div');
      tmp.style.color=hex; document.body.appendChild(tmp);
      const [r,g,b]=getComputedStyle(tmp).color.match(/\d+/g).map(Number);
      document.body.removeChild(tmp);
      return {r,g,b,a:255};
    }
    function floodfill(data,sx,sy,fill,tol,w,h){
      const base=data.slice((sy*w+sx)*4, (sy*w+sx)*4+4);
      const diff=(a,b)=>Math.abs(a[0]-b[0])
        +Math.abs(a[1]-b[1])
        +Math.abs(a[2]-b[2])
        +Math.abs(a[3]-b[3]);
      const isMatch=px=>diff(px,base)<tol;
      const stk=[{x:sx,y:sy}], vis=new Uint8Array(w*h);
      while(stk.length){
        const {x,y}=stk.pop();
        if(x<0||x>=w||y<0||y>=h) continue;
        const i=y*w+x; if(vis[i]) continue;
        vis[i]=1;
        const off = i*4;
        const curr = data.slice(off,off+4);
        if(!isMatch(curr)) continue;
        data[off]=fill.r; data[off+1]=fill.g;
        data[off+2]=fill.b; data[off+3]=fill.a;
        stk.push({x:x+1,y},{x:x-1,y},{x,y:y+1},{x,y:y-1});
      }
    }

    function applyTransform(){
      canvas.style.transform = `translate(${pan.x}px,${pan.y}px) scale(${scale})`;
    }

    showHome();
  </script>
</body>
</html>
