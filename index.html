<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Coloring Book</title>
<style>
  body { margin:0; padding:0; display:flex; flex-direction: column; height:100vh; overflow:hidden; }
  #toolbar { flex:0 0 auto; background:#eee; padding:8px; display:flex; gap:8px; }
  #palette-container {
    flex:0 0 auto;
    background:#f9f9f9;
    overflow-x:auto;
    white-space:nowrap;
    padding:6px;
  }
  .color-swatch {
    width:20px; height:20px;
    margin-right:4px;
    border:1px solid #aaa;
    display:inline-block;
    cursor:pointer;
    flex:0 0 auto;
  }
  #canvas-wrapper {
    flex:1 1 auto;
    position:relative;
    background:#ddd;
    overflow:hidden;
  }
  #drawing-canvas {
    position:absolute;
    top:0; left:0;
    cursor:grab;
    background: white;
  }
  #pager { flex:0 0 auto; background:#eee; padding:8px; display:flex; align-items:center; gap:8px; }
  #page-thumbs { flex:0 0 auto; overflow-x:auto; background:#ccc; padding:6px; white-space:nowrap; }
  .thumb {
    width:60px; height:60px;
    margin-right:6px; display:inline-block;
    border:2px solid transparent;
    cursor:pointer;
    object-fit:cover;
  }
  .thumb.selected { border-color:#333; }
</style>
</head>
<body>

<div id="toolbar">
  <button id="undo">Undo</button>
  <button id="redo">Redo</button>
  <button id="save">Save</button>
  <button id="download">Download</button>
  <button id="clear">Clear</button>
</div>

<div id="palette-container"></div>
<div id="canvas-wrapper"><canvas id="drawing-canvas"></canvas></div>

<div id="pager">
  <button id="prev-page">◀ Prev</button>
  <span id="page-info">Page 1 / 1</span>
  <button id="next-page">Next ▶</button>
</div>
<div id="page-thumbs"></div>

<script>
// === CONFIG ===
const paletteColors = [
  '#000','#666','#999','#CCC','#FFF',
  '#F00','#0F0','#00F','#FF0','#0FF','#F0F',
  '#800','#080','#008','#880','#088','#808'
];
const drawings = [
  'https://i.postimg.cc/TPZTn08W/0f00c43f3775ba5fcce443f4885aa56e.jpg',
  'https://i.postimg.cc/JnZMxXmY/bunny-carrot-coloring-page-600nw-2414476443.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/pLsT5KXD/6331b296558cf1f8f7fd87cc9154f432.jpg',
  'https://i.postimg.cc/2yYmK5Sk/7113dc553901fe5719b2c9e221449e28.jpg',
  'https://i.postimg.cc/jS1TrcSk/Barbie-10.jpg',
  'https://i.postimg.cc/MKxKs9n7/adorable-fun-kids-coloring-page-delight-freepik-908673-3027.jpg'',
  'https://i.postimg.cc/FsDmTN5v/Barbie-24.jpg',
  'https://i.postimg.cc/FsDmTN5v/Barbie-24.jpg',
  'https://i.postimg.cc/j2YdYXZr/Barbie-27.jpg',
  'https://i.postimg.cc/tTxCcfd5/Barbie-6.jpg'
  ];
// =============

const undoStack = [];
let redoStack = [];
let currentColor = paletteColors[0];
let currentPage = 0;

const canvas = document.getElementById('drawing-canvas');
const ctx = canvas.getContext('2d');
const wrapper = document.getElementById('canvas-wrapper');

function loadPage(idx) {
  currentPage = idx;
  const img = new Image();
  img.onload = () => {
    canvas.width = img.width;
    canvas.height = img.height;
    canvas.style.left = '0px';
    canvas.style.top = '0px';
    ctx.drawImage(img, 0, 0);
    saveState();
    updateUI();
  }
  img.src = drawings[idx];
}

function saveState() {
  undoStack.push(canvas.toDataURL());
  if (undoStack.length > 50) undoStack.shift();
  redoStack = [];
}

function undo() {
  if (undoStack.length < 2) return;
  redoStack.push(undoStack.pop());
  const img = new Image();
  img.onload = () => ctx.drawImage(img, 0, 0);
  img.src = undoStack[undoStack.length-1];
}

function redo() {
  if (!redoStack.length) return;
  const data = redoStack.pop();
  const img = new Image();
  img.onload = () => { ctx.drawImage(img,0,0); saveState(); };
  img.src = data;
}

function clearCanvas() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  saveState();
}

function downloadCanvas() {
  const link = document.createElement('a');
  link.download = `page_${currentPage+1}.png`;
  link.href = canvas.toDataURL();
  link.click();
}

function updateUI() {
  document.getElementById('page-info').textContent = `Page ${currentPage+1} / ${drawings.length}`;
  thumbs.forEach((t,i) => togglet(t, i === currentPage));
}

let thumbs = [];
function initThumbnails() {
  const thumbsContainer = document.getElementById('page-thumbs');
  thumbsContainer.innerHTML = '';
  drawings.forEach((src,i) => {
    const img = new Image();
    img.className = 'thumb';
    img.onload = () => {};
    img.src = src;
    img.onclick = () => loadPage(i);
    thumbs.push(img);
    thumbsContainer.appendChild(img);
  });
}

function togglet(elm, sel) {
  elm.classList.toggle('selected', sel);
}

// Palette
const pal = document.getElementById('palette-container');
paletteColors.forEach(c => {
  const sw = document.createElement('div');
  sw.className = 'color-swatch';
  sw.style.background = c;
  sw.onclick = () => currentColor = c;
  pal.appendChild(sw);
});

// Drawing
let drawing = false;
canvas.addEventListener('mousedown', (e) => {
  if (e.button !== 0) return;
  drawing = true;
  ctx.beginPath();
  const r = canvas.getBoundingClientRect();
  ctx.moveTo(e.clientX - r.left, e.clientY - r.top);
});
canvas.addEventListener('mousemove', (e) => {
  if (!drawing) return;
  const r = canvas.getBoundingClientRect();
  ctx.lineTo(e.clientX - r.left, e.clientY - r.top);
  ctx.strokeStyle = currentColor;
  ctx.lineWidth = 5;
  ctx.lineCap = 'round';
  ctx.stroke();
});
canvas.addEventListener('mouseup', () => {
  if (!drawing) return;
  drawing = false;
  saveState();
});

// Dragging canvas
let drag = false, startX, startY, origX, origY;
canvas.addEventListener('mousedown', e => {
  if (e.button !== 1) return;
  drag = true;
  startX = e.clientX;
  startY = e.clientY;
  origX = parseInt(canvas.style.left) || 0;
  origY = parseInt(canvas.style.top) || 0;
  canvas.style.cursor = 'grabbing';
});
document.addEventListener('mousemove', e => {
  if (!drag) return;
  canvas.style.left = origX + (e.clientX - startX) + 'px';
  canvas.style.top = origY + (e.clientY - startY) + 'px';
});
document.addEventListener('mouseup', () => {
  if (drag) {
    drag = false;
    canvas.style.cursor = 'grab';
  }
});

// Buttons & nav
document.getElementById('undo').onclick = undo;
document.getElementById('redo').onclick = redo;
document.getElementById('clear').onclick = clearCanvas;
document.getElementById('download').onclick = downloadCanvas;
document.getElementById('save').onclick = () => alert('Save to GitHub manually');

document.getElementById('prev-page').onclick = () => {
  if (currentPage > 0) loadPage(currentPage - 1);
};
document.getElementById('next-page').onclick = () => {
  if (currentPage < drawings.length - 1) loadPage(currentPage + 1);
};

// Init all
if (drawings.length > 0) {
  initThumbnails();
  loadPage(0);
}
</script>
</body>
</html>
