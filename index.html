<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Coloring Book App</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Comic Sans MS', cursive, sans-serif;
      height: 100%;
      width: 100%;
      overflow: hidden;
      touch-action: none;
      background: linear-gradient(to top right, #fff6e0, #ffe4e1);
    }
    body {
      display: flex;
      flex-direction: column;
    }
    #home, #library, #pageSelect, #drawing {
      display: none;
      flex: 1;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #home {
      background: linear-gradient(to bottom right, #ffdee9, #b5fffc);
    }
    .home-btn {
      margin: 20px;
      border: none;
      background: transparent;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .home-btn:hover {
      transform: scale(1.05);
    }
    .home-btn img {
      width: 180px;
    }
    #pageSelect img, #library img {
      width: 150px;
      margin: 10px;
      border: 3px solid #f06292;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    #pageSelect img:hover, #library img:hover {
      transform: scale(1.05);
    }
    #top-bar {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      background: #ffe0f0;
      padding: 12px;
      border-bottom: 2px solid #f06292;
    }
    .top-btn {
      padding: 10px 18px;
      font-size: 16px;
      border: none;
      background: #f06292;
      color: white;
      border-radius: 10px;
      cursor: pointer;
      box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
    }
    .top-btn:hover {
      background: #ec407a;
    }
    #canvas-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
    }
    canvas {
      border: 3px solid #f06292;
      border-radius: 10px;
      max-width: 100%;
      max-height: 100%;
      touch-action: none;
      background: #fff5f8;
    }
    #bottom-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background: #ffe0f0;
      padding: 10px;
      border-top: 2px solid #f06292;
    }
    .tool, .color {
      margin: 5px;
      padding: 8px;
      border: 2px solid #f06292;
      border-radius: 8px;
      font-size: 22px;
      cursor: pointer;
      background: white;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
    }
    .color {
      width: 32px;
      height: 32px;
    }
    .active {
      border: 3px solid #ff4081 !important;
    }
  </style>
</head>
<body>
<div id="home">
  <button class="home-btn" onclick="playSound(clickSound); showLibrary()">
    <img src="https://img.icons8.com/clouds/200/000000/opened-folder.png" alt="Library" />
  </button>
  <button class="home-btn" onclick="playSound(clickSound); showPageSelect()">
    <img src="https://img.icons8.com/clouds/200/paint-palette.png" alt="Coloring Book" />
  </button>
</div><div id="library"></div>
<div id="pageSelect"></div>
<div id="drawing">
  <div id="top-bar">
    <button class="top-btn" onclick="playSound(clickSound); undo()">Undo</button>
    <button class="top-btn" onclick="playSound(clickSound); redo()">Redo</button>
    <button class="top-btn" onclick="playSound(saveSound); save()">Save</button>
    <button class="top-btn" onclick="playSound(clearSound); clearCanvas()">Clear</button>
    <button class="top-btn" onclick="playSound(downloadSound); download()">Download</button>
  </div>
  <div id="canvas-container">
    <canvas id="drawCanvas" width="800" height="800"></canvas>
  </div>
  <div id="bottom-bar">
    <div class="tool" data-tool="bucket">ðŸª£</div>
    <div class="tool" data-tool="eraser">ðŸ§½</div>
  </div>
</div><audio id="clickSound" src="https://www.soundjay.com/button/sounds/button-29.mp3"></audio> <audio id="saveSound" src="https://www.soundjay.com/button/sounds/button-3.mp3"></audio> <audio id="clearSound" src="https://www.soundjay.com/button/sounds/button-2.mp3"></audio> <audio id="downloadSound" src="https://www.soundjay.com/button/sounds/button-16.mp3"></audio>

<script>
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
const img = new Image();
const savedImages = [];
let tool = 'bucket';
let color = 'black';
let isDragging = false, dragStartX = 0, dragStartY = 0;
let scale = 1, offsetX = 0, offsetY = 0;
const undoStack = [], redoStack = [];

const clickSound = document.getElementById('clickSound');
const saveSound = document.getElementById('saveSound');
const clearSound = document.getElementById('clearSound');
const downloadSound = document.getElementById('downloadSound');
function playSound(audio) {
  audio.currentTime = 0;
  audio.play();
}

function showHome() {
  hideAll(); document.getElementById('home').style.display = 'flex';
}
function showLibrary() {
  hideAll();
  const lib = document.getElementById('library');
  lib.style.display = 'flex';
  lib.style.flexWrap = 'wrap';
  lib.innerHTML = '<h2>Saved Images</h2>';
  savedImages.forEach(src => {
    const img = document.createElement('img');
    img.src = src;
    lib.appendChild(img);
  });
  const back = document.createElement('button');
  back.textContent = 'â¬… Back';
  back.onclick = showHome;
  lib.appendChild(back);
}
function showPageSelect() {
  hideAll();
  const ps = document.getElementById('pageSelect');
  ps.style.display = 'flex';
  ps.style.flexWrap = 'wrap';
  ps.innerHTML = '<h2>Select a Drawing</h2>';
  const drawings = [
    'https://i.postimg.cc/TPZTn08W/0f00c43f3775ba5fcce443f4885aa56e.jpg',
    'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg'
  ];
  drawings.forEach((src, i) => {
    const thumb = document.createElement('img');
    thumb.src = src;
    thumb.onclick = () => loadPage(src);
    ps.appendChild(thumb);
  });
  const back = document.createElement('button');
  back.textContent = 'â¬… Back';
  back.onclick = showHome;
  ps.appendChild(back);
}
function loadPage(src) {
  hideAll();
  document.getElementById('drawing').style.display = 'flex';
  img.onload = () => {
    ctx.fillStyle = '#fff';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    pushUndo();
  };
  img.crossOrigin = 'anonymous';
  img.src = src + '?v=' + Date.now();
}
function hideAll() {
  document.querySelectorAll('#home, #library, #pageSelect, #drawing').forEach(el => el.style.display = 'none');
}
document.querySelectorAll('.tool').forEach(el => {
  el.onclick = () => { tool = el.dataset.tool; updateUI(); };
});
const colors = ['black','gray','white','red','orange','yellow','green','blue','purple','pink','brown','#ffe0bd','#ffcd94','#eac086','#d4a373','#c68642'];
colors.forEach(c => {
  const div = document.createElement('div');
  div.className = 'color';
  div.style.background = c;
  div.onclick = () => { color = c; updateUI(); };
  document.getElementById('bottom-bar').appendChild(div);
});
function updateUI() {
  document.querySelectorAll('.tool').forEach(el => el.classList.toggle('active', el.dataset.tool === tool));
  document.querySelectorAll('.color').forEach(el => el.classList.toggle('active', el.style.backgroundColor === color));
}
function getXY(e) {
  const rect = canvas.getBoundingClientRect();
  return {
    x: Math.floor((e.clientX - rect.left - offsetX) / scale),
    y: Math.floor((e.clientY - rect.top - offsetY) / scale)
  };
}
canvas.addEventListener('mousedown', e => {
  isDragging = true;
  dragStartX = e.clientX - offsetX;
  dragStartY = e.clientY - offsetY;
  handleInput(e);
});
canvas.addEventListener('mousemove', e => {
  if (isDragging) {
    offsetX = e.clientX - dragStartX;
    offsetY = e.clientY - dragStartY;
    canvas.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
  }
});
canvas.addEventListener('mouseup', () => isDragging = false);
canvas.addEventListener('touchstart', e => {
  dragStartX = e.touches[0].clientX - offsetX;
  dragStartY = e.touches[0].clientY - offsetY;
  handleInput(e.touches[0]);
});
canvas.addEventListener('touchmove', e => {
  e.preventDefault();
  offsetX = e.touches[0].clientX - dragStartX;
  offsetY = e.touches[0].clientY - dragStartY;
  canvas.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
}, { passive: false });
canvas.addEventListener('touchend', () => isDragging = false);
function handleInput(e) {
  const {x, y} = getXY(e);
  if (tool === 'bucket') {
    const imgd = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const rgba = hexToRGBA(color);
    floodfill(imgd.data, x, y, rgba, 20, canvas.width, canvas.height);
    ctx.putImageData(imgd, 0, 0);
    pushUndo();
  } else if (tool === 'eraser') {
    ctx.globalCompositeOperation = 'destination-out';
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, 2 * Math.PI);
    ctx.fill();
    ctx.globalCompositeOperation = 'source-over';
    pushUndo();
  }
}
function floodfill(data, sx, sy, fill, tol, w, h) {
  const index = (sy * w + sx) * 4;
  const base = data.slice(index, index + 4);
  const match = (i) => Math.abs(data[i]-base[0])+Math.abs(data[i+1]-base[1])+Math.abs(data[i+2]-base[2]) < tol;
  const stack = [{x: sx, y: sy}], visited = new Uint8Array(w*h);
  while (stack.length) {
    const {x, y} = stack.pop();
    if (x<0||x>=w||y<0||y>=h) continue;
    const i = (y*w+x)*4;
    if (!match(i)||visited[y*w+x]) continue;
    data[i]=fill.r; data[i+1]=fill.g; data[i+2]=fill.b; data[i+3]=255;
    visited[y*w+x]=1;
    stack.push({x:x+1,y},{x:x-1,y},{x,y+1},{x,y-1});
  }
}
function hexToRGBA(hex) {
  const tmp = document.createElement('div');
  tmp.style.color = hex;
  document.body.appendChild(tmp);
  const [r, g, b] = getComputedStyle(tmp).color.match(/\d+/g).map(Number);
  document.body.removeChild(tmp);
  return {r, g, b, a: 255};
}
function pushUndo() {
  undoStack.push(canvas.toDataURL());
  if (undoStack.length > 50) undoStack.shift();
  redoStack.length = 0;
}
function undo() {
  if (undoStack.length < 2) return;
  redoStack.push(undoStack.pop());
  restore(undoStack[undoStack.length - 1]);
}
function redo() {
  if (!redoStack.length) return;
  const data = redoStack.pop();
  undoStack.push(data);
  restore(data);
}
function restore(src) {
  const image = new Image();
  image.onload = () => ctx.drawImage(image, 0, 0);
  image.src = src;
}
function save() {
  savedImages.push(canvas.toDataURL());
  alert('Saved to Library!');
}
function clearCanvas() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  pushUndo();
}
function download() {
  const a = document.createElement('a');
  a.href = canvas.toDataURL('image/png');
  a.download = 'my_coloring.png';
  a.click();
}
showHome();
</script></body>
</html>
