<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Coloring App</title>
<style>
html,body{margin:0;padding:0;height:100%;overflow:hidden;touch-action:none;font-family:'Comic Sans MS';background:#fff6e0}
#home,#library,#pageSelect,#drawing{display:none;flex-direction:column;width:100%;height:100%}
#home{display:flex;justify-content:center;align-items:center;background:linear-gradient(to bottom right,#ffdee9,#b5fffc)}
.home-btn img{width:180px}
#library h2,#pageSelect h2{margin:0;padding:10px;font-size:1.5rem;font-weight:bold;color:#f06292;}
#library,#pageSelect{display:flex;flex-direction:column;overflow-y:auto;align-items:center;padding:0;}
#pageSelect img,#library img{width:150px;margin:10px;border:3px solid #f06292;border-radius:10px;cursor:pointer}
#top-bar{display:flex;gap:5px;padding:8px;background:#ffe0f0;overflow-x:auto;flex-shrink:0}
#canvas-container{flex:1;position:relative;overflow:hidden;background:#fff}
canvas{display:block;touch-action:none;border-radius:10px}
#bottom-bar{display:flex;gap:5px;overflow-x:auto;background:#ffe0f0;padding:8px;flex-shrink:0;border-top:2px solid #ccc;box-shadow:inset 0 5px 5px -5px rgba(0,0,0,0.3)}
button,.tool,.color{padding:6px;font-size:16px;border:none;border-radius:8px;cursor:pointer;background:#f06292;color:white;box-shadow:2px 2px 5px rgba(0,0,0,0.2);flex-shrink:0}
.tool,.color{width:36px;height:36px;display:flex;align-items:center;justify-content:center}
.color{border:3px solid #333}
.active{border:3px solid #ff4081!important}
</style>
</head>
<body>
<div id="home">
  <button class="home-btn" onclick="showLibrary()"><img src="https://img.icons8.com/clouds/200/000000/opened-folder.png"/></button>
  <button class="home-btn" onclick="showPageSelect()"><img src="https://img.icons8.com/clouds/200/000000/paint-palette.png"/></button>
</div>

<div id="library"><h2>My Album</h2><div><button onclick="showHome()">‚¨Ö Back</button></div></div>
<div id="pageSelect"><h2>Coloring Book</h2><div><button onclick="showHome()">‚¨Ö Back</button></div></div>

<div id="drawing" style="display:flex;flex-direction:column;height:100%">
  <div id="top-bar">
    <button onclick="undo()">‚éå</button>
    <button onclick="redo()">‚Üª</button>
    <button onclick="save()">üíæ</button>
    <button onclick="download()">‚¨á</button>
    <button onclick="clearCanvas()">üóë</button>
    <button onclick="showHome()">üè†</button>
  </div>
  <div id="canvas-container"><canvas id="canvas"></canvas></div>
  <div id="bottom-bar"></div>
</div>

<audio id="clickSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_059f6bff69.mp3?filename=click-124467.mp3"></audio>

<script>
const STORAGE_KEY='myColorLib';
let saved=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');
const canvas=document.getElementById('canvas'),ctx=canvas.getContext('2d');
const img=new Image(); img.crossOrigin='anonymous';
const clickSound=document.getElementById('clickSound');
let tool='bucket',color='black',scale=1,tx=0,ty=0,isDrag=false,start=null,lastDist=null;
const undoStack=[],redoStack=[];
const colors=['black','darkgray','red','orange','yellow','lime','green','teal','blue','navy','purple','magenta','hotpink','peachpuff','tan','saddlebrown','white','cyan','magenta','olive','maroon','#8B0000','#00CED1','#ADFF2F','#FF1493','#FF4500','#2E8B57'];
const drawings=[
  'https://i.postimg.cc/TPZTn08W/0f00c43f3775ba5fcce443f4885aa56e.jpg',
  'https://i.postimg.cc/JnZMxXmY/bunny-carrot-coloring-page-600nw-2414476443.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/TPZTn08W/0f00c43f3775ba5fcce443f4885aa56e.jpg',
  'https://i.postimg.cc/JnZMxXmY/bunny-carrot-coloring-page-600nw-2414476443.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/pLsT5KXD/6331b296558cf1f8f7fd87cc9154f432.jpg',
  'https://i.postimg.cc/2yYmK5Sk/7113dc553901fe5719b2c9e221449e28.jpg',
  'https://i.postimg.cc/MKxKs9n7/adorable-fun-kids-coloring-page-delight-freepik-908673-3027.jpg',
  'https://i.postimg.cc/MKxKs9n7/adorable-fun-kids-coloring-page-delight-freepik-908673-3027.jpg',
  'https://i.postimg.cc/jS1TrcSk/Barbie-10.jpg',
  'https://i.postimg.cc/FsDmTN5v/Barbie-24.jpg',
  'https://i.postimg.cc/FsDmTN5v/Barbie-24.jpg',
  'https://i.postimg.cc/j2YdYXZr/Barbie-27.jpg',
  'https://i.postimg.cc/tTxCcfd5/Barbie-6.jpg'
];

function resizeCanvas(){
  const r=document.getElementById('canvas-container').getBoundingClientRect();
  canvas.width=r.width;canvas.height=r.height;
  drawImageScaled();
}
window.addEventListener('resize',resizeCanvas);

function init(){
  const bottom=document.getElementById('bottom-bar');
  colors.forEach(c=>{
    const d=document.createElement('div');
    d.className='color'; d.style.background=c;
    d.onclick=()=>{color=c;updateUI();clickSound.play()};
    bottom.appendChild(d);
  });
  ['bucket','eraser'].forEach(name=>{
    const t=document.createElement('div');
    t.className='tool'; t.dataset.tool=name;
    t.textContent=name==='bucket'?'ü™£':'üßΩ';
    t.onclick=()=>{tool=name;updateUI();clickSound.play()};
    bottom.appendChild(t);
  });
  updateUI();

  const ps=document.getElementById('pageSelect');
  drawings.forEach((src,i)=>{
    const im=document.createElement('img');
    im.src=src;
    im.onclick=()=>loadPage(i);
    ps.appendChild(im);
  });

  const lib=document.getElementById('library');
  document.querySelector('#library button').onclick=showHome;
  const pb=document.getElementById('pageSelect');
  document.querySelector('#pageSelect button').onclick=showHome;

  showHome();
  window.onload=resizeCanvas;
}

function updateUI(){
  document.querySelectorAll('.tool').forEach(el=>el.classList.toggle('active',el.dataset.tool===tool));
  document.querySelectorAll('.color').forEach(el=>el.classList.toggle('active',el.style.background===color));
}

function hideAll(){['home','library','pageSelect','drawing'].forEach(id=>document.getElementById(id).style.display='none')}
function showHome(){hideAll();document.getElementById('home').style.display='flex'}
function showLibrary(){
  hideAll();
  const lib=document.getElementById('library');
  lib.innerHTML='<h2>My Album</h2>';
  saved.forEach(s=>{
    const i=document.createElement('img'); i.src=s; lib.appendChild(i);
  });
  const btn=document.createElement('button');
  btn.textContent='‚¨Ö Back'; btn.onclick=showHome; lib.appendChild(btn);
  lib.style.display='flex';
}
function showPageSelect(){
  hideAll();document.getElementById('pageSelect').style.display='flex';
}
function loadPage(i){
  hideAll();document.getElementById('drawing').style.display='flex';
  img.onload=()=>{scale=1;tx=ty=0;drawImageScaled();push()}
  img.src=drawings[i]+'?v='+Date.now();
  resizeCanvas();
}

// ... [omitting unchanged touch/zoom/flood code for brevity; it's the same logic as before] ...

function getXY(e){
  const pt=new DOMPoint(e.clientX,e.clientY);
  const inv=ctx.getTransform().inverse();
  const loc=pt.matrixTransform(inv);
  return {x:Math.floor(loc.x),y:Math.floor(loc.y)};
}

function onPointer(e){
  if(!img.src)return;
  const bg={r:255,g:246,b:224,a:255};
  const p=getXY(e);
  clickSound.currentTime=0;clickSound.play();
  const id=ctx.getImageData(0,0,canvas.width,canvas.height),d=id.data;
  if(tool==='bucket')flood(d,p.x,p.y,hexToRGBA(color),25,canvas.width,canvas.height);
  else flood(d,p.x,p.y,bg,25,canvas.width,canvas.height);
  ctx.putImageData(id,0,0);
  push();
}

canvas.addEventListener('mousedown',e=>{isDrag=true;start={x:e.clientX,y:e.clientY}});
canvas.addEventListener('mousemove',e=>{if(!isDrag)return;tx+=e.clientX-start.x;ty+=e.clientY-start.y;start={x:e.clientX,y:e.clientY};apply()});
canvas.addEventListener('mouseup',_=>isDrag=false);
canvas.addEventListener('mouseleave',_=>isDrag=false);
canvas.addEventListener('click',onPointer);

canvas.addEventListener('touchstart',onTouchStart);
canvas.addEventListener('touchmove',onTouchMove,{passive:false});
canvas.addEventListener('touchend',_=>{isDrag=false;if(event.touches.length<2)lastDist=null});

function apply(){
  const m=new DOMMatrix().translate(tx,ty).scale(scale);
  canvas.style.transform = `translate(${tx}px,${ty}px) scale(${scale})`;
  ctx.setTransform(m);
  drawImageScaled(); // refresh after pan/zoom
}

// Flood and other helper functions unchanged‚Ä¶

init();
</script>
</body>
</html>
