<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coloring Book App</title>
<style>
  html,body{margin:0;padding:0;height:100%;font-family:'Comic Sans MS';background:#fff6e0;overflow:hidden;}
  #home,#library,#pageSelect,#drawing{display:none;flex-direction:column;align-items:center;height:100%;overflow:hidden;}
  #home{display:flex;justify-content:center;align-items:center;background:linear-gradient(to bottom right,#ffdee9,#b5fffc);}
  .home-btn{border:none;background:none;margin:20px;cursor:pointer;}
  .home-btn img{width:180px;}
  #pageSelect,#library{display:none;flex-wrap:wrap;overflow-y:auto;width:100%;padding:10px;box-sizing:border-box;}
  #pageSelect img,#library img{width:150px;margin:8px;border:3px solid #f06292;border-radius:10px;cursor:pointer;}
  #top-bar,#bottom-bar{display:flex;align-items:center;gap:10px;padding:8px;background:#ffe0f0;box-sizing:border-box;}
  #bottom-bar{overflow-x:auto;scrollbar-color:#f06292 #ffe0f0;}
  #bottom-bar::-webkit-scrollbar{height:8px;}
  #bottom-bar::-webkit-scrollbar-track{background:#ffe0f0;border-radius:4px;}
  #bottom-bar::-webkit-scrollbar-thumb{background:#f06292;border-radius:4px;}
  button,.tool,.color{padding:8px;font-size:18px;border:none;border-radius:8px;cursor:pointer;background:#f06292;color:#fff;box-shadow:2px 2px 6px rgba(0,0,0,0.2);}
  .tool,.color{width:32px;height:32px;display:flex;align-items:center;justify-content:center;flex:0 0 auto;}
  .color{border:2px solid #f06292;border-radius:50%;margin:4px;}
  .active{border:3px solid #ff4081 !important;}
  #canvas-container{flex:1;position:relative;background:#fff;display:flex;justify-content:center;align-items:center;overflow:hidden;}
  canvas{touch-action:none;border-radius:10px;transform-origin:0 0;cursor:grab;transition:transform .1s;}
</style>
</head>
<body>

<div id="home">
  <button class="home-btn" onclick="showLibrary()"><img src="https://img.icons8.com/clouds/200/000000/opened-folder.png"/></button>
  <button class="home-btn" onclick="showPageSelect()"><img src="https://img.icons8.com/clouds/200/000000/paint-palette.png"/></button>
</div>

<div id="library"></div>
<div id="pageSelect"></div>

<div id="drawing">
  <div id="top-bar">
    <button onclick="undo()">Undo</button>
    <button onclick="redo()">Redo</button>
    <button onclick="save()">Save</button>
    <button onclick="download()">Download</button>
    <button onclick="clearCanvas()">Clear</button>
  </div>
  <div id="canvas-container">
    <canvas id="drawCanvas" width="800" height="800"></canvas>
  </div>
  <div id="bottom-bar">
    <div class="tool" data-tool="bucket">ðŸª£</div>
    <div class="tool" data-tool="eraser">ðŸ§½</div>
  </div>
</div>

<audio id="clickSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_059f6bff69.mp3?filename=click-124467.mp3"></audio>

<script>
// Globals & config
const canvas = document.getElementById('drawCanvas'),
      ctx = canvas.getContext('2d'),
      img = new Image(); img.crossOrigin='anonymous';
const clickSound = document.getElementById('clickSound');
let tool='bucket', color='black', scale=1, tx=0, ty=0;
let isDragging=false, dragStart=null, isPanning=false, panStart=null, lastDist=null;
const drawings = [
  'https://i.postimg.cc/TPZTn08W/0f00c43f3775ba5fcce443f4885aa56e.jpg',
  'https://i.postimg.cc/JnZMxXmY/bunny-carrot-coloring-page-600nw-2414476443.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/pLsT5KXD/6331b296558cf1f8f7fd87cc9154f432.jpg',
  
];
const savedImages=[], undoStack=[], redoStack=[];

// UI Functions
function playClick(){ clickSound.currentTime=0; clickSound.play(); }
function hideAll(){ ['home','library','pageSelect','drawing'].forEach(id=>document.getElementById(id).style.display='none'); }
function showHome(){ hideAll(); document.getElementById('home').style.display='flex'; }
function showLibrary(){
  hideAll(); const lib=document.getElementById('library');
  lib.style.display='flex'; lib.innerHTML='<h2>Saved</h2>';
  savedImages.forEach(src=>{ const im=document.createElement('img'); im.src=src; lib.appendChild(im); });
  const b=document.createElement('button'); b.textContent='â¬… Back'; b.onclick=showHome; lib.appendChild(b);
}
function showPageSelect(){
  hideAll(); const ps=document.getElementById('pageSelect');
  ps.style.display='flex'; ps.innerHTML='<h2>Select a Page</h2>';
  drawings.forEach((s,i)=>{ const t=document.createElement('img'); t.src=s; t.onclick=()=>loadPage(i); ps.appendChild(t); });
  const b=document.createElement('button'); b.textContent='â¬… Back'; b.onclick=showHome; ps.appendChild(b);
}
function loadPage(i){
  hideAll(); document.getElementById('drawing').style.display='flex';
  img.onload = ()=>{ resetTransform(); drawImageScaled(); pushUndo(); };
  img.src=drawings[i]+'?v='+Date.now();
}

// Tools & palette
document.querySelectorAll('.tool').forEach(el=>el.onclick=()=>{
  playClick(); tool=el.dataset.tool; updateUI();
});
const colors = ['black','gray','red','orange','yellow','green','blue','purple','pink','peach','tan','brown','white','cyan','magenta','navy','#f4c2c2'];
colors.forEach(c=>{
  const d=document.createElement('div');
  d.className='color'; d.style.background=c;
  d.onclick=()=>{ playClick(); color=c; updateUI(); };
  document.getElementById('bottom-bar').appendChild(d);
});
function updateUI(){
  document.querySelectorAll('.tool').forEach(el=>el.classList.toggle('active', el.dataset.tool===tool));
  document.querySelectorAll('.color').forEach(el=>el.classList.toggle('active', el.style.background===color));
}

// Pan, zoom, paint!
canvas.addEventListener('mousedown', e=>{
  if(e.button===0){ isDragging=true; dragStart={x:e.clientX, y:e.clientY}; }
  if(e.button===1){ isPanning=true; panStart={x:e.clientX, y:e.clientY}; canvas.style.cursor='grabbing'; e.preventDefault(); }
});
document.addEventListener('mousemove', e=>{
  if(isDragging) paintAt(e);
  if(isPanning){
    tx += e.clientX - panStart.x;
    ty += e.clientY - panStart.y;
    panStart = {x:e.clientX, y:e.clientY};
    applyTransform();
  }
});
document.addEventListener('mouseup', ()=>{
  isDragging=false;
  if(isPanning){ isPanning=false; canvas.style.cursor='grab'; }
});
canvas.addEventListener('wheel', e=>{
  const delta = -e.deltaY * 0.001;
  const prev = scale;
  scale = Math.min(3, Math.max(0.3, scale * (1+delta)));
  const rect=canvas.getBoundingClientRect();
  const cx=e.clientX-rect.left, cy=e.clientY-rect.top;
  tx -= (cx/prev)*(scale/prev - 1);
  ty -= (cy/prev)*(scale/prev - 1);
  applyTransform(); e.preventDefault();
});

canvas.addEventListener('click', e=>paintAt(e));
canvas.addEventListener('touchstart', e=>paintAt(e.touches[0]));
canvas.addEventListener('touchmove', e=>{ pinchZoom(e); }, {passive:false});
canvas.addEventListener('touchend', ()=>lastDist=null);

function pinchZoom(e){
  if(e.touches.length===2){
    e.preventDefault();
    const dx=e.touches[0].clientX - e.touches[1].clientX;
    const dy=e.touches[0].clientY - e.touches[1].clientY;
    const dist=Math.hypot(dx,dy);
    if(lastDist){
      scale *= dist/ lastDist;
      scale = Math.min(3, Math.max(0.3, scale));
      applyTransform();
    }
    lastDist=dist;
  }
}

function applyTransform(){
  canvas.style.transform = `translate(${tx}px,${ty}px) scale(${scale})`;
}

function getXY(e){
  const r=canvas.getBoundingClientRect();
  return {
    x: Math.floor((e.clientX - r.left - tx)/scale),
    y: Math.floor((e.clientY - r.top - ty)/scale)
  };
}

function paintAt(e){
  if(!img.src) return;
  const {x,y} = getXY(e);
  playClick();
  if(tool==='bucket'){
    const data=ctx.getImageData(0,0,canvas.width,canvas.height);
    floodfill(data.data, x, y, hexToRGBA(color), 25, data.width, data.height);
    ctx.putImageData(data, 0, 0);
  } else {
    ctx.globalCompositeOperation='destination-out';
    ctx.beginPath(); ctx.arc(x,y,10,0,2*Math.PI); ctx.fill();
    ctx.globalCompositeOperation='source-over';
  }
  pushUndo();
}

// Floodfill & utility
function floodfill(data, sx, sy, fill, tol, w, h){
  const baseIdx=(sy*w+sx)*4, base=data.slice(baseIdx, baseIdx+4);
  const match=px=>px.every((v,i)=>Math.abs(v-base[i])<tol);
  const stack=[{x:sx,y:sy}], visited=new Uint8Array(w*h);
  while(stack.length){
    const p=stack.pop(), idx=(p.y*w+p.x)*4;
    if(p.x<0||p.y<0||p.x>=w||p.y>=h||visited[p.y*w+p.x]||!match(data.slice(idx,idx+4))) continue;
    visited[p.y*w+p.x]=1;
    [data[idx],data[idx+1],data[idx+2],data[idx+3]]=[fill.r,fill.g,fill.b,fill.a];
    stack.push({x:p.x+1,y:p.y},{x:p.x-1,y:p.y},{x:p.x,y:p.y+1},{x:p.x,y:p.y-1});
  }
}
function hexToRGBA(hex){
  const tmp=document.createElement('div'); tmp.style.color=hex; document.body.appendChild(tmp);
  const [r,g,b]=getComputedStyle(tmp).color.match(/\d+/g).map(Number);
  document.body.removeChild(tmp); return {r,g,b,a:255};
}

// Image draw & undo/redo
function resetTransform(){ scale=1; tx=ty=0; applyTransform(); }
function drawImageScaled(){
  const cw=canvas.width,ch=canvas.height,iw=img.width,ih=img.height,
        ratio=Math.min(cw/iw,ch/ih);
  ctx.clearRect(0,0,cw,ch);
  ctx.drawImage(img,0,0,iw,ih,(cw-iw*ratio)/2,(ch-ih*ratio)/2,iw*ratio,ih*ratio);
}
function pushUndo(){
  undoStack.push(canvas.toDataURL());
  if(undoStack.length>30) undoStack.shift();
  redoStack.length=0;
}
function undo(){ if(undoStack.length<2)return; redoStack.push(undoStack.pop()); restore(undoStack[undoStack.length-1]); }
function redo(){ if(!redoStack.length)return; const d=redoStack.pop(); undoStack.push(d); restore(d); }
function restore(src){ const i=new Image(); i.onload = ()=>{ resetTransform(); ctx.drawImage(i,0,0); }; i.src=src; }
function clearCanvas(){ drawImageScaled(); pushUndo(); }
function save(){ savedImages.push(canvas.toDataURL()); alert('Saved!'); }
function download(){ const a=document.createElement('a'); a.href=canvas.toDataURL(); a.download='coloring.png'; a.click(); }

// Start
showHome();
</script>
</body>
</html>
