<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Coloring Book App</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      height: 100%;
      width: 100%;
      overflow: hidden;
      touch-action: none;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    #home, #library, #pageSelect, #drawing {
      display: none;
      flex: 1;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    #home {
      background: linear-gradient(to bottom right, brown, red);
    }

    .home-btn {
      margin: 20px;
      border: none;
      background: none;
      cursor: pointer;
    }

    .home-btn img {
      width: 200px;
      height: auto;
    }

    #pageSelect img, #library img {
      width: 150px;
      margin: 10px;
      border: 2px solid #333;
      cursor: pointer;
    }

    #top-bar {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      align-items: center;
      width: 100%;
      background: #f8f8f8;
      padding: 10px;
    }

    .top-btn {
      font-size: 18px;
      margin: 4px;
      padding: 10px 20px;
      background: #ffc107;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .top-btn:hover {
      background: #ff9800;
    }

    #canvas-container {
      flex: 1;
      overflow: hidden;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
    }

    canvas {
      border: 1px solid #ccc;
      max-width: 100%;
      max-height: 100%;
      touch-action: none;
      transform-origin: 0 0;
    }

    #bottom-bar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background: #eee;
      padding: 10px;
    }

    .tool, .color {
      margin: 4px;
      padding: 6px;
      border: 2px solid #333;
      border-radius: 6px;
      font-size: 20px;
      cursor: pointer;
    }

    .color {
      width: 30px;
      height: 30px;
    }

    .active {
      border: 3px solid red !important;
    }
  </style>
</head>
<body>

<div id="home">
  <button class="home-btn" onclick="showLibrary()">
    <img src="https://img.icons8.com/clouds/200/000000/opened-folder.png" alt="Library" />
  </button>
  <button class="home-btn" onclick="showPageSelect()">
    <img src="https://img.icons8.com/clouds/200/paint-palette.png" alt="Coloring Book" />
  </button>
</div>

<div id="library"></div>
<div id="pageSelect"></div>

<div id="drawing">
  <div id="top-bar">
    <button class="top-btn" onclick="undo()">Undo</button>
    <button class="top-btn" onclick="redo()">Redo</button>
    <button class="top-btn" onclick="save()">Save</button>
    <button class="top-btn" onclick="clearCanvas()">Clear</button>
    <button class="top-btn" onclick="download()">Download</button>
  </div>
  <div id="canvas-container">
    <canvas id="drawCanvas" width="800" height="800"></canvas>
  </div>
  <div id="bottom-bar">
    <div class="tool" data-tool="bucket">ðŸª£</div>
    <div class="tool" data-tool="eraser">ðŸ§½</div>
  </div>
</div>

<script>
const drawings = [
  'https://i.postimg.cc/TPZTn08W/0f00c43f3775ba5fcce443f4885aa56e.jpg',
  'https://i.postimg.cc/Bv8q8yz0/36-girl-with-butterfly-wings-to-color.jpg',
  'https://i.postimg.cc/pLsT5KXD/6331b296558cf1f8f7fd87cc9154f432.jpg'
];
const savedImages = [];
const canvas = document.getElementById('drawCanvas');
const ctx = canvas.getContext('2d');
const img = new Image();
img.crossOrigin = 'anonymous';

let tool = 'bucket';
let color = 'black';
let scale = 1, panX = 0, panY = 0;
let isDragging = false, lastX = 0, lastY = 0;

const undoStack = [];
const redoStack = [];

function showHome() {
  hideAll();
  document.getElementById('home').style.display = 'flex';
}
function showLibrary() {
  hideAll();
  const lib = document.getElementById('library');
  lib.style.display = 'flex';
  lib.style.flexWrap = 'wrap';
  lib.innerHTML = '<h2>Saved Images</h2>';
  savedImages.forEach(src => {
    const img = document.createElement('img');
    img.src = src;
    lib.appendChild(img);
  });
  const back = document.createElement('button');
  back.textContent = 'â¬… Back';
  back.onclick = showHome;
  lib.appendChild(back);
}
function showPageSelect() {
  hideAll();
  const ps = document.getElementById('pageSelect');
  ps.style.display = 'flex';
  ps.style.flexWrap = 'wrap';
  ps.innerHTML = '<h2>Select a Drawing</h2>';
  drawings.forEach((src, i) => {
    const thumb = document.createElement('img');
    thumb.src = src;
    thumb.onclick = () => loadPage(i);
    ps.appendChild(thumb);
  });
  const back = document.createElement('button');
  back.textContent = 'â¬… Back';
  back.onclick = showHome;
  ps.appendChild(back);
}
function loadPage(idx) {
  hideAll();
  document.getElementById('drawing').style.display = 'flex';
  img.onload = () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = '#fff';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    pushUndo();
  };
  img.src = drawings[idx] + '?v=' + Date.now();
}
function hideAll() {
  document.getElementById('home').style.display = 'none';
  document.getElementById('library').style.display = 'none';
  document.getElementById('pageSelect').style.display = 'none';
  document.getElementById('drawing').style.display = 'none';
}
document.querySelectorAll('.tool').forEach(el => {
  el.onclick = () => { tool = el.dataset.tool; updateUI(); };
});
const colors = [
  'black','gray','white','red','orange','yellow','green','blue','purple','pink','brown',
  '#fce3da','#fcd5b4','#eac086','#d4a373','#c68642','#ffe0bd','#ffdbac'
];
colors.forEach(c => {
  const div = document.createElement('div');
  div.className = 'color';
  div.style.background = c;
  div.onclick = () => { color = c; updateUI(); };
  document.getElementById('bottom-bar').appendChild(div);
});
function updateUI() {
  document.querySelectorAll('.tool').forEach(el => el.classList.toggle('active', el.dataset.tool === tool));
  document.querySelectorAll('.color').forEach(el => el.classList.toggle('active', el.style.backgroundColor === color));
}
function getXY(e) {
  const r = canvas.getBoundingClientRect();
  return {
    x: Math.floor((e.clientX - r.left - panX) / scale),
    y: Math.floor((e.clientY - r.top - panY) / scale)
  };
}
canvas.addEventListener('mousedown', e => {
  isDragging = true;
  lastX = e.clientX;
  lastY = e.clientY;
  handleInput(e);
});
canvas.addEventListener('mousemove', e => {
  if (isDragging && tool === 'move') {
    panX += e.clientX - lastX;
    panY += e.clientY - lastY;
    updateTransform();
    lastX = e.clientX;
    lastY = e.clientY;
  }
});
canvas.addEventListener('mouseup', () => isDragging = false);
canvas.addEventListener('touchstart', e => handleInput(e.touches[0]));
canvas.addEventListener('touchmove', e => {
  if (e.touches.length === 1) {
    e.preventDefault();
    panX += e.touches[0].clientX - lastX;
    panY += e.touches[0].clientY - lastY;
    updateTransform();
    lastX = e.touches[0].clientX;
    lastY = e.touches[0].clientY;
  }
}, { passive: false });
canvas.addEventListener('touchend', () => isDragging = false);
function updateTransform() {
  canvas.style.transform = `translate(${panX}px, ${panY}px) scale(${scale})`;
}
function handleInput(e) {
  const {x, y} = getXY(e);
  if (tool === 'bucket') {
    const imgd = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const rgba = hexToRGBA(color);
    floodfill(imgd.data, x, y, rgba, 25, imgd.width, imgd.height);
    ctx.putImageData(imgd, 0, 0);
    pushUndo();
  } else if (tool === 'eraser') {
    ctx.globalCompositeOperation = 'destination-out';
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, 2 * Math.PI);
    ctx.fill();
    ctx.globalCompositeOperation = 'source-over';
    pushUndo();
  }
}
function hexToRGBA(hex) {
  const tmp = document.createElement('div');
  tmp.style.color = hex;
  document.body.appendChild(tmp);
  const [r, g, b] = getComputedStyle(tmp).color.match(/\d+/g).map(Number);
  document.body.removeChild(tmp);
  return {r, g, b, a: 255};
}
function floodfill(data, sx, sy, fill, tol, w, h) {
  const index = (sy * w + sx) * 4;
  const base = data.slice(index, index + 4);
  const colorDiff = (p1, p2) => Math.abs(p1[0]-p2[0])+Math.abs(p1[1]-p2[1])+Math.abs(p1[2]-p2[2])+Math.abs(p1[3]-p2[3]);
  const isMatch = (px) => colorDiff(px, base) < tol;
  const stack = [{x: sx, y: sy}];
  const visited = new Uint8Array(w * h);
  while (stack.length) {
    const {x, y} = stack.pop();
    if (x < 0 || x >= w || y < 0 || y >= h) continue;
    if (visited[y * w + x]) continue;
    visited[y * w + x] = 1;
    const i = (y * w + x) * 4;
    const current = data.slice(i, i + 4);
    if (!isMatch(current)) continue;
    data[i] = fill.r; data[i + 1] = fill.g; data[i + 2] = fill.b; data[i + 3] = fill.a;
    stack.push({x: x + 1, y}, {x: x - 1, y}, {x, y: y + 1}, {x, y: y - 1});
  }
}
function pushUndo() {
  undoStack.push(canvas.toDataURL());
  if (undoStack.length > 50) undoStack.shift();
  redoStack.length = 0;
}
function undo() {
  if (undoStack.length < 2) return;
  redoStack.push(undoStack.pop());
  restore(undoStack[undoStack.length - 1]);
}
function redo() {
  if (!redoStack.length) return;
  const data = redoStack.pop();
  undoStack.push(data);
  restore(data);
}
function restore(src) {
  const image = new Image();
  image.onload = () => ctx.drawImage(image, 0, 0);
  image.src = src;
}
function save() {
  const data = canvas.toDataURL();
  savedImages.push(data);
  alert('Saved to Library!');
}
function clearCanvas() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  pushUndo();
}
function download() {
  const a = document.createElement('a');
  a.href = canvas.toDataURL('image/png');
  a.download = 'coloring.png';
  a.click();
}

showHome();
</script>
</body>
</html>
